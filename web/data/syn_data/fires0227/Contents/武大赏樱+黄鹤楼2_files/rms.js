var RMS=function(){var e,t,n=location.protocol+"//cdid.c-ctrip.com/model-poc2/h",o=location.protocol.replace("http","ws")+"//cdid.c-ctrip.com/model-poc2/w",r=!1,i=location.protocol+"//"+location.host;function a(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].join("_"));return t.join("-")}function c(e,t){for(var n=[],o=0;o<e.length;o++){n[o]=[];for(var r=0;r<t;r++)n[o][r]=0}return n}var s=[["J_mobile","p_name_0","mobilephone","nloginname","givenName_0"],["pickupEmail","I_contact_phone","txtContactEMail","npwd","contactPhoneNum"],["p_card_no_0","card_number_1","card_number_2","card_number_3","card_number_4","card_number","cardNum_0_0"]],d=[["J_resident_1"],["J_resident_2"],["txtContactMobilePhone","J_mobile"]],u=[0,0,0],p=c(s,10),h=c(d,3),l=function(e){var t=e.target||e.srcElement;if(e.keyCode||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey){for(var n=-1,o=0;o<d.length;o++)for(var r=0;r<d[o].length;r++)if(d[o][r]==t.id){n=o;break}if(-1!=n)try{e.ctrlKey&&67==e.keyCode&&(h[n][0]=1),e.ctrlKey&&86==e.keyCode&&(h[n][1]=1),e.ctrlKey&&88==e.keyCode&&(h[n][2]=1)}catch(e){console.log(e)}n=-1;for(o=0;o<s.length;o++)for(r=0;r<s[o].length;r++)if(s[o][r]==t.id){n=o;break}if(-1!=n)try{var i=!1;(e.metaKey||e.ctrlKey)&&67==e.keyCode&&(p[n][0]=1,i=!0),(e.metaKey||e.ctrlKey)&&86==e.keyCode&&(p[n][1]=1,i=!0),(e.metaKey||e.ctrlKey)&&88==e.keyCode&&(p[n][2]=1,i=!0),8==e.keyCode&&"keydown"==e.type&&(p[n][3]+=1,i=!0),0==u[n]?u[n]=1*new Date:p[n][4]=1*new Date-u[n],e.altKey&&"keydown"==e.type&&(p[n][6]=1,i=!0),e.shiftKey&&"keydown"==e.type&&(p[n][7]+=1,i=!0),e.shiftKey&&e.ctrlKey&&"keydown"==e.type&&(p[n][8]+=1,i=!0),e.ctrlKey&&32==e.keyCode&&(p[n][9]+=1,i=!0),i?p[n][5]+=1:"keydown"==e.type&&(p[n][5]+=1)}catch(e){console.log(e)}}};document.addEventListener?(document.addEventListener("keydown",l,!1),document.addEventListener("keyup",l,!1)):(document.attachEvent("onkeydown",l),document.attachEvent("onkeyup",l));var f=function(){var e,t=window,n=(t.XMLHttpRequest&&"withCredentials"in new t.XMLHttpRequest?e=t.XMLHttpRequest:t.XDomainRequest&&(e=t.XDomainRequest),e),o=["head","get","post","put","delete"],r={};function i(e){this.init(e)}i.prototype.init=function(e){this.xhr=new n,this.method=e.method,this.url=e.url,this.success=e.success,this.error=e.error;try{this.xhr.timeout=2e3,this.xhr.ontimeout=function(e){},!0===e.credentials&&(this.xhr.withCredentials=!0)}catch(e){}var t=e.params?e.params:e.data;return this.headers=e.headers,this.send(t),this},i.prototype.send=function(e){var t=this;return void 0!==t.success&&(t.xhr.onload=function(){t.success.call(this,this.responseText)}),void 0!==t.error&&(t.xhr.error=function(){t.error.call(this,this.responseText)}),t.xhr.open(t.method,t.url,!0),void 0!==t.headers&&t.setHeaders(),e?t.xhr.send(e):t.xhr.send(),t},i.prototype.setHeaders=function(){var e,t=this.headers;try{for(e in t)t.hasOwnProperty(e)&&this.xhr.setRequestHeader(e,t[e])}catch(e){}return this};for(var a=0;a<o.length;a++)!function(){var e=o[a];r[e]=function(t,n){var o={};if(void 0===t)throw new Error("CORS: url must be defined");return"object"==typeof t?o=t:("function"==typeof n&&(o.success=n),o.url=t),o.method=e.toUpperCase(),new i(o).xhr}}();return r}(),m=function(e,t,n){var o=document.createElement("input");return o.type="hidden",o.name=t,o.value=n,o.id=t+"_d__",e.appendChild(o),o},w=function(n,o,a,c){if(r)return setTimeout(function(){w(n,o,a)},30);if(r=!0,"XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest){var s=o+"="+a+"&serverName="+i;f.post({url:n,credentials:!0,params:s,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(e){r=!1,e?c&&c(e,!0):c&&c(e,!1)},error:function(){r=!1,c&&c(data,!1)}})}else{if(createIframe(),e.action=n,t.name=o,t.value=a,guid){var d=document.getElementById("guid_d__");d?d.value=guid:m(e,"guid",guid)}e.submit()}},c=!1;return{init:function(e){if(!c){c=!0,e=e||{};var t=this;if(window.__bfi=window.__bfi||[],window.__bfi.push(["_getFP",function(e){t.fp=e},!1]),window.__bfi.push(["_getStatus",function(e){t.vid=e.vid},!1]),window.__bfi.push(["_getPageid",function(n,o){!n&&o&&(e.pageId||(e.pageId=o+"")),t.pageId=o}]),window&&window.location){var n=!0,o=/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/,r=o.exec(window.location);(n=!r)||(n=r=(o=/^https?:\/\/(([0-9a-zA-Z\.]*qa\.nt\.ctripcorp\.))/).exec(window.location)),n&&(setTimeout(function(){var e=document.createElement("script");e.type="text/javascript",e.id="rmsd__script",e.async=!0,e.src=("https:"==document.location.protocol?"https:":"http:")+"//webresource.c-ctrip.com/resaresonline/risk/ubtrms/d.min.ae216d54.js",e.crossOrigin="anonymous";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},10),window.rmsd__startScriptLoad=1*new Date)}!function(){var e=window.__rmsbfi||[],t=e.push=function(){for(var e=arguments,t=0,n=e.length,o=0;o<n;o++)try{if("function"==typeof e[o])e[o]();else if("[object Array]"===Object.prototype.toString.call(e[o])){if(2!=e[o].length)continue;var r=e[o][0],i=e[o][1];"string"==typeof r&&"_getRmsToken"===r&&"function"==typeof i&&i(RMS.getRmsToken())}}catch(e){t++}return t};for(window.__rmsbfi=e;e.length>0;)t(e.shift())}()}},getRmsToken:function(){var e="fp="+(this.fp?this.fp:"");e+="&vid="+(this.vid?this.vid:""),e+="&pageId="+(this.pageId?this.pageId:"");var t=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),n=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);if(t&&t.length>1)e+="&r="+t[1].replace(/\-/g,"");else if(n&&n.length>1){e+="&r="+n[1].replace(/\-/g,"")}else e+="&r="+window.CHLOROFP_STATUS;var o,r,i=window.CHLOROFP_IP;if(!i){var c=/\_RF1=([0-9\.]+)(;|$)/.exec(document.cookie);c&&c.length>1&&(i=c[1])}isNaN(Number(i))||(o=Number(i),(r=new Array)[0]=o>>>24>>>0,r[1]=o<<8>>>24>>>0,r[2]=o<<16>>>24,r[3]=o<<24>>>24,i=String(r[0])+"."+String(r[1])+"."+String(r[2])+"."+String(r[3])),i&&(i=i.replace(/^\s+|\s+$/g,"")),e+="&ip="+i,e+="&rg="+window.RG_STA,e+="&kpData="+a([h[2]]),e+="&kpControl="+a([h[0],h[1]]),e+="&kpEmp="+a(p),e+="&screen="+screen.width+"x"+screen.height;var s=(new Date).getTimezoneOffset()/60;e+="&tz="+(s<0?"+":"-")+Math.abs(s),e+="&blang="+navigator.language||navigator.userLanguage,e+="&oslang="+navigator.language||navigator.systemLanguage,e+="&ua="+encodeURIComponent(navigator.userAgent);var d=/^https?:\/\/([a-zA-Z0-9.\-_]+)\/?/.exec(window.location);if(d&&d.length>1){var u=d[1];e+="&d="+encodeURIComponent(u)}return e+="&v=22",this.uuid&&(e+="&rmsId="+this.uuid),e},ping:function(e){if(window&&window.location&&"WebSocket"in window){if(!/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/.exec(window.location)){if(!e){var t=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),r=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);t&&t.length>1?e=t[1].replace(/\-/g,""):r&&r.length>1&&(e=r[1].replace(/\-/g,""))}if(e){e=e+"_"+(a=1,c=100,Math.floor(Math.random()*(c-a+1))+a);var i=new WebSocket(o);i.addEventListener("open",function(t){i.send(e)}),i.addEventListener("message",function(t){var n=t.data;"OK"===n?i.close():i.send(n+":"+e)}),window.RG_STA="b4",w(n,"requestId",e,function(e,t){t?(window.CHLOROFP_IP=window.CHLOROFP_IP||e,window.RG_STA="fin"):window.RG_STA="err"})}}}var a,c}}}();RMS.init(),RMS.ping();