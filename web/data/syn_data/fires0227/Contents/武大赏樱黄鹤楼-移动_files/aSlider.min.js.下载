define("AdSlider",["cStore","cModel","cCoreInherit","UIImageSlider","cLocalStorage","cCommonStore","cUtilCommon","cGeoService","cUtilHybrid"],function(cStore,cModel,cCoreInherit,UIImageSlider,cLocalStorage,cCommonStore,cUtilCommon,cGeoService,cUtilHybrid){var localProtocol=window.location.protocol,localIsHybrid=!/^(http:|https:)/gi.test(localProtocol),defaultSOAProtocol="https:",soaProtocol=localIsHybrid?defaultSOAProtocol:localProtocol,defaultImgProtocol="https:";var adSliderControl=_.inherit(UIImageSlider,{propertys:function($super){$super();this.UtilCommon=cUtilCommon;this.GeoService=cGeoService;this.LocalStorage=cLocalStorage.getInstance();this.HeadStore=cCommonStore.HeadStore.getInstance();this.UserStore=cCommonStore.UserStore.getInstance();this.BizType=0;this.PageCode=0;this.TagId="";this.BackupImageUrl="";this.IsNav=true;this.IsNoAdHide=false;this.ExpandSetTrackLog=function(t,e){};this.AdLoadComplete=function(t,e){};this.Height=0;this.IsLoadComplete=false;this.IsBackupLoadComplete=false;this.hpageid="";this.pageid="";this.Theme="";this.PageId="";this.dotheight=0;this.SiteID="";this.AllianceID="";this.SID="";this.OUID="";this.DataList=[];this.FullDataList=[];this.SiteType="";this.TemplateVal="";this.TemplateType="";this.ThirdLoadkUrl="";this.LonAndLat={IsEnable:true,CityID:"",Lon:"",Lat:""};this.jumpbySelf=false;this.handleItemClick=function(t){}},_setTrackLog:function(t,e,i,a){if(this.wrapper.css("display")=="none"||$("#"+e.Id).length==0){this.stop();return}this._setUBTTrackLog.call(this,t,e);this.ExpandSetTrackLog(t,e);if(t==3){var n=this;var o=e.LinkUrl.toLowerCase();window.setTimeout(function(){n.play();if(o.indexOf("richurl://")>-1){n._tabScreenBus(e)}else{Common.JumpUrl(e.LinkUrl,i,a)}},200)}},_tabScreenBus:function(t){var e=new RegExp(/richurl\:\/\/biztype=(\d+)&pagecode=(\d+)&templateval=(\d+)&templatetype=([a-zA-Z]+)&pageid=(\d+)/);var i="mktRichMedia_"+Common.CreateGuid();$("body").append(Common.StringFormat('<div id="{0}" class="mkt-ad-ccc2" style="display:none"></div>',[i]));var a=e.exec(t.LinkUrl.toLowerCase());if(!!a&&a.length==6){this.Ad=(new adSliderControl).Load({BizType:a[1],PageCode:a[2],TagId:i,ThirdLoadkUrl:t.ThirdLoadTrackUrl,TemplateVal:a[3],TemplateType:"Interstitial",PageId:a[5]})}},_setUBTTrackLog:function(t,e){var i=this.HeadStore.get();var a=Lizard.isHybrid||Lizard.isInCtripApp?i.cid:Common.GetVId();if(Common.StringIsNullOrEmpty(this.PageId)){return}var n="UserId="+a+"&PageId="+this.PageId;if(t==1){n+="&PositionIdVSAdId="+e.AdvertisementPosition;if(e.IsDy){n+=":"+e.AID}}else if(t==4){n+="&SvrLoadTime="+(this.V4EndT-this.V4StartT)+"&FirstImgShowTime="+(this.FirstImgShowT-this.V4EndT)+"&FirstImgShowTimeTotal="+(this.FirstImgShowT-this.StartTime)}else if(t==5){n+="&DySvrLoadTime="+(this.DyEndT-this.DyStartT)+"&DyImgLoadTime="+(this.DyImgLoadT-this.DyEndT)+"&DyImgLoadTimeTotal="+(this.DyImgLoadT-this.StartTime)}else{n+="&PositionId="+e.AdvertisementPosition+"&AdId="+e.AID+"&src="+e.SrcUrl}if(Lizard.isHybrid||Lizard.isInCtripApp){n+="&cver="+i.cver}var o=Common.GetStorage("SiteID"+this.CacheKey)||"";var r=Common.GetStorage("SiteType"+this.CacheKey)||"";n+="&SiteType="+r+"&SiteID="+o;if(e.IsDy){var s=Common.StringIsNullOrEmpty(e.MKTID)?"":e.MKTID;n+="&uid="+s;n+="&vid="+a;if(!Common.StringIsNullOrEmpty(e.BITraceLog)){n+="&"+e.BITraceLog}}Common.SetUBTTrackLog(t,n)},_firstImgShow:function(t){t&&this._setTrackLog.call(this,4,t)},_dyAdImgLoad:function(t){t&&this._setTrackLog.call(this,5,t)},_dySumAdpv:function(t){if(t.length>0){var e=[];$.each(t,function(t,i){if(!i.IsDy&&i.AdvertisementPosition&&i.AID){e.push(i.AdvertisementPosition+":"+i.AID)}});if(e.length>0){this._setUBTTrackLog.call(this,1,{AdvertisementPosition:e.join("-")})}}else{this._setUBTTrackLog.call(this,1,t)}},SetLoadTiming:function(){if(this.IsLoadAdComplate&&this.IsLoadDyAdComplate){var t=this.V4EndT-this.V4StartT;var e=this.DyEndT-this.DyStartT;var i=[];var a=true;$.each(this.DataList,function(t,e){a=a&&e.IsRequest;if(!e.IsRequest){return}var n={PlaceID:e.PlaceID,AdID:e.ADID,AdType:e.Adtype,ImgLoadTime:e.LoadImgEndT-e.LoadImgStartT};i.push(n)});if(a){this.IsLoadAdComplate=false;this.IsLoadDyAdComplate=false;var n=[];var o={AdList:i,SvrLoadTime:t,DySvrLoadTime:e};n.push(o);this.AdBusiness.GetMonitoring(n,function(){var t="发送监控数据请求完成!"})}}},Load:function(t){try{if(!$.isEmptyObject(t)){if(t.length>=3){this.BizType=t[0];this.PageCode=t[1];this.TagId=t[2];if(t.length==4){this.BackupImageId=t[3]}}else{for(var e in t){this[e]=t[e]}}}if(Common.StringIsNullOrEmpty(this.TagId)){return}if(Common.StringIsNullOrEmpty(this.PageId)){this.PageId=Lizard.isHybrid?this.hpageid:this.pageid}this.CacheKey=this.BizType+"_"+this.PageCode+"_"+this.SiteID;var i=Common.JsonToObject(Common.GetStorage("UNION"));if(this.AllianceID==""&&this.SID==""&&this.OUID==""){if(!Common.IsEmptyObject(i)){var a=Common.Clone(i);if(!!a.data){this.AllianceID=a.data.AllianceID?a.data.AllianceID:"";this.SID=a.data.SID?a.data.SID:"";this.OUID=a.data.OUID?a.data.OUID:""}else if(!!a.value){this.AllianceID=a.value.AllianceID?a.value.AllianceID:"";this.SID=a.value.SID?a.value.SID:"";this.OUID=a.value.OUID?a.value.OUID:""}}}var n=this.HeadStore.get();this.cver=n.cver;this.StartTime=(new Date).getTime();o.call(this);this.AdBusiness=new AdBusiness(this);this.AdBusiness.Init();function o(){this.datamodel.itemFn=function(t){return s(t)};this.displayNum=1;this.autoPlay=false;this.delaySec=3e3;this.wrapper=$("#"+this.TagId);this.wrapper.addClass("mkt-ad-ccc");this.wrapper.html("");var t="//webresource.c-ctrip.com/ResMarketOnline/R2/css/aFrame/abase.css";if(Lizard.isHybrid&&d(this.cver)){t="../advertisement/css/abase.css"}else if(!Lizard.isHybrid){t=Common.ReplaceHttp(t)}Common.LoadLink(t);r.call(this);this._initialize()}function r(){if(!Common.StringIsNullOrEmpty(this.Theme)){var t="";if(this.Theme.toLowerCase()=="hotel"){this.wrapper.addClass("hotel");t="//webresource.c-ctrip.com/ResMarketOnline/R2/css/aFrame/hotel-theme.css";if(Lizard.isHybrid&&d(this.cver)){t="../advertisement/css/hotel-theme.css"}else if(!Lizard.isHybrid){t=Common.ReplaceHttp(t)}Common.LoadLink(t)}}}function s(t){if(t.IsDy&&!Common.StringIsNullOrEmpty(t.Style)){document.getElementById("dyadStyle")==null&&Common.LoadCss("dyadStyle",t.Style)}var e=[];e.push(Common.StringFormat('<img src="{0}" id="{1}"/>',[t.SrcUrl,t.Id]));if(t.IsDy&&!Common.StringIsNullOrEmpty(t.Content)){e.push(t.Content)}if(t.TemplID=="Creative_Templ"){Common.LoadLink(t.Style);e.unshift(t.Templ)}return e.join("")}function d(t){var e=t.split(".");if(e.length>=2){var i=parseInt(e[0]),a=parseInt(e[1]);if(i>6||i==6&&a>=9){return true}}return false}}catch(l){}return this},destroy:function($super){this.stop();this.wrapper.html("");$super()},_initialize:function(){var t=this;this.itemClick=function(e){if(e!=undefined){t._setTrackLog.call(t,3,e,t.jumpbySelf,t.handleItemClick)}};this.changed=function(e){if(e!=undefined&&!e.IsVisible){e.IsVisible=true;t.datamodel.currentADID=e.ADID;t._setTrackLog.call(t,2,e)}var i=t;window.setTimeout(function(){i.play()},200)};this.DySumAdpv=function(e){t._dySumAdpv(e)}},_SetResize:function(t){if(t&&t.length>0){var e=this;var i,a;for(var n=0;n<t.length;n++){if(t[n].Width&&t[n].Width>0){i=t[n].Width;a=t[n].Height;break}}o.call(this,i,a);$(window).off("resize.slider"+this.TagId);$(window).on("resize.slider"+this.TagId,function(){o.call(e,i,a,true)})}function o(t,e,i){var a=this;if(t>0&&e>0){if($("#"+this.TagId).width()>0){this.Height=parseInt(e*$("#"+this.TagId).width()/t)}else{this.Height=parseInt(e*$(document).width()/t)}if(!Common.StringIsNullOrEmpty(this.Theme)){if(this.Theme.toLowerCase()=="hotel"){this.Height=this.Height*2}}this.wrapper.height(this.Height);if(i){this.wrapper.find("li").each(function(){var t=this;setTimeout(function(){$(t).css({"font-size":a.Height+"px",height:a.Height+"px"})},100)});this.wrapper.find("div.cm-slide").each(function(){var t=this;setTimeout(function(){$(t).height(a.Height)},100)})}}}},BandData:function(t,e){function i(){if(t.length>0){var i=this;this.DataList=t;this.FullDataList=e;this._SetResize(t);a(t,this)}else{!this.IsBackupLoadComplete&&this.AdLoadComplete(this,1)}}function a(e,i){d(e,i);l(t);i.AdCount=e.length;i.AdLoadErrorCount=0;$.each(e,function(t,e){if(e.IsDy){i._dySumAdpv(e)}n(e,i)})}function n(t,e){t.IsRequest=false;t.IsLoad=false;if(!Common.StringIsNullOrEmpty(t.SrcUrl)){var i=new Image;i.src=t.SrcUrl;t.LoadImgStartT=(new Date).getTime();i.onload=function(){t.LoadImgEndT=(new Date).getTime();t.IsRequest=true;t.IsLoad=true;a(e,t);e.SetLoadTiming()};i.onerror=function(){t.LoadImgEndT=(new Date).getTime();t.IsRequest=true;a(e,t);e.SetLoadTiming();o(e)}}else{t.IsRequest=true;a(e,t);e.SetLoadTiming();o(e)}function a(t,e){if(t.GetDataList(e)){t.SliderReLoad(e)}}}function o(t){t.AdLoadErrorCount+=1;if(t.AdCount==t.AdLoadErrorCount){!t.IsBackupLoadComplete&&t.AdLoadComplete(t,1)}}function r(t,e){this._setTrackLog(t,e)}function s(t,e){this._setUBTTrackLog(t,e)}function d(t,e){var i=[];var a=[];$.each(t,function(t,e){if(!e.IsDy&&e.AdvertisementPosition&&e.AID){if(e.Adtype<100){i.push(e.AdvertisementPosition+":"+e.AID)}else{a.push(e.AdvertisementPosition+":"+e.AID)}}});if(i.length>0){s.call(e,1,{AdvertisementPosition:i.join("-")})}if(a.length>0){s.call(e,1,{AdvertisementPosition:a.join("-")})}}function l(t){$.each(t,function(t,e){if(!Common.StringIsNullOrEmpty(e.ThirdLoadTrackUrl)){var i=new Image;i.src=Common.AddUrlRandom(e.ThirdLoadTrackUrl)}})}i.call(this)},DyAdBandData:function(t){var e=this;var i=0;var a=0;var n=Common.GetStorage("BidAdCount"+e.CacheKey);var o=Common.GetStorage("DyAdIndex"+e.CacheKey);var r=this.AddDyAdData(this.DataList,t,this.FullDataList);if(r&&t&&t.AID>0){t.IsRequest=false;t.IsLoad=false;t.IsSync=true;i=t.AID;a=t.Index;this._dySumAdpv(t);var s=new Image;s.src=t.SrcUrl;t.LoadImgStartT=(new Date).getTime();s.onload=function(){t.IsRequest=true;t.LoadImgEndT=(new Date).getTime();if(r==t){r.IsLoad=true;d(e,r)}e.SetLoadTiming()};s.onerror=function(){t.IsRequest=true;t.LoadImgEndT=(new Date).getTime();if(r==t){r.IsLoad=true;d(e,r)}e.SetLoadTiming()}}if(e.sumAdPvData&&e.sumAdPvData.length>0){this._dySumAdpv(e.sumAdPvData)}if(r&&r.SrcUrl){if(!Common.StringIsNullOrEmpty(r.SrcUrl)){$.each(e.sumAdPvData,function(t,i){var a=new Image;a.src=i.SrcUrl;i.LoadImgStartT=(new Date).getTime();a.onload=function(){i.IsRequest=true;i.LoadImgEndT=(new Date).getTime();if(r==i){r.IsLoad=true;d(e,r)}e.SetLoadTiming()};a.onerror=function(){i.IsRequest=true;i.LoadImgEndT=(new Date).getTime();if(r==i){d(e,r)}e.SetLoadTiming()}})}else{r.IsRequest=true;d(e,r);e.SetLoadTiming()}}else{e.SetLoadTiming()}function d(t,e){if(t.GetDataList(e)){}t.SliderReLoad(e)}},GetDataList:function(t){var e=this.DataList.length>0;var i=this;var a=[];$.each(this.DataList,function(i,a){if(!a.IsRequest&&a.Index<=t.Index){e=false;return false}});if(e){n(this.DataList,0);this.datamodel.data=a}if(t.IsSync){this.datamodel.data=this.DataList}function n(t,e){if(e>=t.length){return}var i=t[e];if(i.IsRequest){if(i.IsLoad){a.push(i)}n(t,e+1)}}return e},AddDyAdData:function(t,e,i){if(t&&t.length>0){for(var a=0;a<t.length;a++){if(t[a].Adtype>=100||t[a].IsDy){return}}}var a=0;var n=null;var o=Common.GetStorage("DyAdIndex"+this.CacheKey);var r=Common.GetStorage("BidAdCount"+this.CacheKey);var s=o;var d=e&&e.AID>0;if(d&&(s>0||t.length==0)){n=e}var l=r-(s<=0||(e==null||!(e.AID>0))?0:1)-t.length;var d=e&&e.AID>0;if(d){var c=false;if(l>=0&&s>0){for(var a=0;a<t.length;a++){var m=t[a];if(s<=m.Index){t.splice(a,0,e);c=true;break}}}if(!c){t.push(e)}if(i&&i.length){for(var a=0;a<i.length;a++){if(i[a].Index==e.Index){e.AdvertisementPosition=i[a].AdvertisementPosition;break}}}}this.sumAdPvData=[];if(l>0&&this.AdDataList&&this.AdDataList.length>0){for(var h=0;h<l&&h<this.AdDataList.length;h++){for(var u=0;u<r;u++){if(!n||n.Index>this.AdDataList[h].Index){n=this.AdDataList[h]}if(!t[u]){this.AdDataList[h].IsSync=true;t.push(this.AdDataList[h]);this.sumAdPvData.push(this.AdDataList[h]);break}else if(t[u].Index>u+1){this.AdDataList[h].IsSync=true;t.splice(u,0,this.AdDataList[h]);this.sumAdPvData.push(this.AdDataList[h]);break}}}}return n},SliderReLoad:function(t){if(t.IsDy&&!Common.StringIsNullOrEmpty(t.Style)){document.getElementById("dyadStyle")==null&&Common.LoadCss("dyadStyle",t.Style)}else{this.datamodel.data=this.datamodel.data.sort(function(t,e){return t.Index>e.Index?1:-1})}if(this.datamodel.data&&this.datamodel.data.length){this._SetResize(this.datamodel.data)}this.autoPlay=this.datamodel.data.length>1;this.needLoop=this.datamodel.data.length>1;if(!this.IsLoadComplete){this.wrapper.html("");this.wrapper.show();this.IsLoadComplete=true;this.show();!this.IsBackupLoadComplete&&this.AdLoadComplete(this,0);if(!Common.StringIsNullOrEmpty(this.BackupImageId)){$("#"+this.BackupImageId).remove()}}this.stop();this.reload();if(!this.FirstImgShowT&&t.Index==1){this.FirstImgShowT=(new Date).getTime();this._firstImgShow(t)}if(!this.DyImgLoadT&&t.IsDy){this.DyImgLoadT=(new Date).getTime();this._dyAdImgLoad(t)}if(t.IsSync){if(this.datamodel.data.length>1){for(var e=0;e<this.datamodel.data.length;e++){if(this.datamodel.data[e].ADID==this.datamodel.currentADID){break}}a.call(this,e)}else if(this.datamodel.data.length==1){a.call(this,0)}}if(this.datamodel.data.length>1){this.play()}else if(this.datamodel.data.length==1&&this.scroll!=null){this.scroll.destroy();this.scroll=null}i.call(this);this.changed(this.datamodel.data[0]);function i(){var t=this;if(this.datamodel.data.length==1||!this.IsNav){this.sliderNav.hide()}else{var e=6;if(t.dotheight&&t.dotheight!=0){e=t.dotheight}this.sliderNav.css({bottom:e+"px"});this.sliderNav.show();this.sliderNav.find("span").off("click");this.sliderNav.find("span").on("click",function(){var e=parseInt($(this).attr("data-index"));if(e>=0){a.call(t,e);if(e<t.datamodel.data.length){t.changed(t.datamodel.data[e])}}})}this.wrapper.find("li").each(function(){$(this).css({"font-size":t.Height+"px",height:t.Height+"px"})});this.wrapper.find("div.cm-slide").each(function(){$(this).height(t.Height)})}function a(t){this.datamodel.index=t;this.setIndex(t,null,null,this.playTime);this._setNavIndex(t)}},GetHead:function(){var t=this.UserStore.getAuth();if(!t||t==""){t=Common.GetCookie("cticket")}if(!t||t==""){t=null}this.HeadStore.setAuth(t);return this.HeadStore.get()}});var BaseModel=new cCoreInherit.Class(cModel,{__propertys__:function(){this.method="POST";this.param={}},buildurl:function(){var t="";var e=OutInterface.GetRootUrl()+this.url+".json";Common.Env=OutInterface.Env;return e}});var AdDataModel={};AdDataModel.GetMonitoringModel=new cCoreInherit.Class(BaseModel,{__propertys__:function(){this.url="GetMonitoring"}});AdDataModel.GetGlobalADListV4Model=new cCoreInherit.Class(BaseModel,{__propertys__:function(){this.url="GetGlobalADListV4"}});AdDataModel.GetDyAdDataModel=new cCoreInherit.Class(BaseModel,{__propertys__:function(){this.url="GetDynamicAd"}});function Common(){}Common.IsArray=function(t){if(t==null||t==undefined){return false}return typeof t=="object"&&t.length>=0};Common.IsEmptyObject=function(t){if(t===null||t===undefined){return true}if(typeof t=="object"&&t.length>0){return false}if(typeof t=="object"){var e=false;for(var i in t){e=true;break}return!e}return false};Common.JsonToObject=function(jsonString){if(Common.StringIsNullOrEmpty(jsonString)||typeof jsonString!="string"){return null}jsonString=Common.StringTrim(jsonString);try{return eval("("+jsonString+")")}catch(ex){}return null};Common.IsFunction=function(t){return typeof t=="function"};Common.StringTrim=function(t){return t===undefined||t===null?"":t.replace(/(^\s*)|(\s*$)/g,"").replace(/(^　*)|(　*$)/g,"")};Common.GetCookie=function(t){var e=null;if(document.cookie&&document.cookie!=""){var i=document.cookie.split(";");for(var a=0;a<i.length;a++){var n=Common.StringTrim(i[a]);if(n.substring(0,t.length+1)==t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}}return e};Common.StringFormat=function(t,e){if(Common.StringIsNullOrEmpty(t)){return""}if($.isArray(e)){for(var i=0;i<e.length;i++){e[i]=Common.StringIsNullOrEmpty(e[i])?"":e[i].toString();t=t.replace(new RegExp("\\{"+i.toString()+"\\}","g"),e[i])}}return t};Common.StringIsNullOrEmpty=function(t){return t===null||t===undefined||Common.StringTrim(t.toString())==""};Common.LoadCss=function(t,e){var i=document.createElement("style");i.type="text/css";i.id=t;if(typeof i.styleSheet!="undefined"){i.styleSheet.cssText=e}else{i.innerHTML=e}document.getElementsByTagName("head")[0].appendChild(i)};Common.LoadLink=function(t){var e=document.createElement("link");e.type="text/css";e.rel="stylesheet";e.href=t;document.getElementsByTagName("head")[0].appendChild(e)};Common.LoadJS=function(t,e,i){var a=document.head||document.getElementsByTagName("head")[0];var n=document.createElement("script");n.type="text/javascript";n.charset="utf-8";n.async=true;n.onload=function(){e&&e()};n.onerror=function(){i&&i();a.removeChild(n)};n.src=t;a.appendChild(n)};Common.JumpUrl=function(t,e,i){if(!t||t=="#"){return}if(e&&Common.IsFunction(i)){i(t)}else{Lizard.jump(t,{targetModel:Lizard.isHybrid||Lizard.isInCtripApp?2:0})}};Common.GetCookie=function(t){var e=null;if(document.cookie&&document.cookie!=""){var i=document.cookie.split(";");for(var a=0;a<i.length;a++){var n=Common.StringTrim(i[a]);if(n.substring(0,t.length+1)==t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}}return e};Common.ArrayForeach=function(t,e){for(var i=0;i<t.length;i++){if(e(t[i],i)===false){break}}};Common.SetStorage=function(t,e){try{localStorage.setItem(t,e)}catch(i){}};Common.GetStorage=function(t){var e="";try{e=localStorage.getItem(t)}catch(i){}return Common.StringIsNullOrEmpty(e)?"":e};Common.IsObject=function(t){if(t==null||t==undefined){return false}return typeof t=="object"&&Object.prototype.toString.call(t).toLowerCase()=="[object object]"&&!t.length};Common.Clone=function(t){if($.isEmptyObject(t)){return t}if($.isArray(t)){var e=[];for(var i=0;i<t.length;i++){e.push(Common.Clone(t[i]))}return e}else if(Common.IsObject(t)){var a={};for(var n in t){if($.isArray(t[n])||Common.IsObject(t[n])){a[n]=Common.Clone(t[n])}else{a[n]=t[n]}}return a}return t};Common.SetUBTTrackLog=function(t,e){window.__bfi=window.__bfi||[];var i=t==2?"AdPV":t==3?"AdClick":t==1?"sumadpv":t==4?"100323":t==5?"100323":"";i!=""&&window.__bfi.push(["_tracklog",i,e])};Common.TrackMetric=function(t,e,i,a,n,o){var r=(new Date).getTime()-t;if(Common.StringIsNullOrEmpty(e)){return}n=n||"";o=o||"";var s={name:"adsdkelapsedtime",value:r,sample:10,tag:{PageId:e,InterfaceType:i,Status:a,SiteType:o,SiteID:n}};window.__bfi=window.__bfi||[];window.__bfi.push(["_trackMetric",s])};Common.GetVId=function(){var t=Common.GetCookie("_bfa");if(t!=null){var e=t.toString().split(".");if(e.length>2){return e[1]+"."+e[2]}}return""};Common.CreateGuid=function(){function t(){return((1+Math.random())*65536|0).toString(16).substring(4)}function e(){var e="";for(var i=1;i<=20;i++){e+=t();if(i===8||i===12||i===16||i===20){e+="-"}}var a=parseInt(8*Math.random());var n=(new Date).getTime()+"";e+=n.slice(0,a);for(var o=0;o<4;o++){e+=t()}e+=n.slice(a+5,13);return e}return e()};Common.ReplaceHttp=function(t){if(Common.StringIsNullOrEmpty(t)){return t}var e=Common.StringTrim(t);if(localIsHybrid){if(/^[\/]{2}/.test(e)){e=defaultImgProtocol+e}}else{e=e.replace(/^(http:|https:)/gi,"")}return e};Common.AddUrlRandom=function(t){if(Common.StringIsNullOrEmpty(t)){return}t+=t.indexOf("?")>0?"&":"?";t+=Common.StringFormat("_r{0}={1}",[Common.GetRandomChars(),Math.random()]);return t};Common.GetRandomChars=function(t){t=t||10;var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz";var i=[];for(var a=0;a<t;a++){i.push(e.charAt(Math.floor(Math.random()*e.length)))}return i.join("")};Common.JsonToString=function(t){if(t===null||t===undefined||Common.IsFunction(t)){return""}return e("",t);function e(t,i){var a="";if(i==null){a="null"}else if(typeof i=="number"){a=i.toString()}else if(typeof i=="boolean"){a=i.toString().toLowerCase()}else if(Common.IsArray(i)){var n=[];for(var o=0;o<i.length;o++){n.push(e("",i[o]))}a="["+n.join(",")+"]"}else if(Common.IsObject(i)){var n=[];for(var r in i){if(!Common.IsFunction(i[r])){n.push(e(r,i[r]))}}a="{"+n.join(",")+"}"}else{a='"'+i.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}return Common.StringIsNullOrEmpty(t)?a:Common.StringFormat('"{0}":{1}',[t,a])}};function OutInterface(){}OutInterface.GetEnvName=function(){if(Lizard.isHybrid){var t=cUtilHybrid.isPreProduction();switch(t){case"1":return"fat";case"2":return"uat";default:return"prd"}}else{var e=window.location.host;if(e.match(/localhost|fws|fat/i)){return"fat"}else if(e.match(/uat/i)){return"uat"}return"prd"}};OutInterface.GetRootUrl=function(){var t="",e,i=OutInterface.GetEnvName(),a=soaProtocol,n=a==="http:";if(i=="fat"){t="gateway.m.fws.qa.nt.ctripcorp.com"}else if(i=="uat"){t="gateway.m.uat.qa.nt.ctripcorp.com"}else{if(n){t="m.ctrip.com"}else{t="sec-m.ctrip.com"}}e=[a,"//",t,"/restapi/soa2/10245/"].join("");OutInterface.Env=i;return e};Common.ClearAdCache=function(){var t="";var e=/^(bidadcount|dyadindex|siteid|sitetype)\d+_\d+_/i;var i=/^(addatalist_\d+_\d+_)_time/i;var a=false;try{if(!!!window.localStorage){return}for(var n in window.localStorage){var o=false;if(i.test(n)){t=localStorage.getItem(n).split("_");if(t.length!=2){return}if(t[0]<(new Date).getTime()){localStorage.removeItem(n);o=true;a=true}if(!!i.exec(n)&&i.exec(n).length==2&&o){localStorage.removeItem(i.exec(n)[1])}}if(e.test(n)&&a){localStorage.removeItem(n)}}}catch(r){}};function DataAccess(){}DataAccess.Request=function(t){if(Common.IsEmptyObject(t)){return}t.Method=t.Method==undefined?"GET":t.Method;if(Common.StringIsNullOrEmpty(t.Url)){return}t.Async=t.Async==undefined?true:t.Async;t.Headers=t.Headers==undefined?{}:t.Headers;t.DataType=t.DataType==undefined?"json":t.DataType;t.ContentType=t.ContentType==undefined?"application/x-www-form-urlencoded":t.ContentType;t.Data=t.Data==undefined?"":t.Data;var e=null;e=a();if(e==null){return}e.open(t.Method,n(t.Url),t.Async,t.User,t.Password);e.setRequestHeader("Accept",t.DataType);e.setRequestHeader("Content-Type",t.ContentType);for(var i in t.Headers){e.setRequestHeader(i,t.Headers[i])}e.onreadystatechange=function(){if(e.readyState==4){if(e.status==200){if(t.SuccessCallback!=undefined&&typeof t.SuccessCallback=="function"){var i;if(t.DataType=="json"){i=Common.JsonToObject(e.responseText)}else if(t.DataType=="xml"){i=e.responseXML}else{i=e.responseText}t.SuccessCallback(i,e)}}else{if(t.ErrorCallback!=undefined&&typeof t.ErrorCallback=="function"){t.ErrorCallback(e)}else{if(Common.StringIsNullOrEmpty(e.responseText)){alert(e.status+":"+e.statusText)}else{alert(e.responseText)}}}}};e.send(t.Data);function a(){try{if(window.XMLHttpRequest){return new XMLHttpRequest}else if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(t){}return null}function n(t){if(t.indexOf("?")>0){t+="&_rm="+Math.random()}else{t+="?_rm="+Math.random()}return encodeURI(t)}return e};DataAccess.PostRequest=function(t,e,i,a,n){var o={};o.Url=t;o.Method="POST";o.Async=n;o.ContentType="application/json; charset=utf-8";o.Data=Common.JsonToString(e);o.SuccessCallback=function(t,e){o.IsCallback=true;i&&i(t,e)};o.ErrorCallback=function(t){o.IsCallback=true;a&&a(t)};var r=DataAccess.Request(o);window.setTimeout(function(){if(!o.IsCallback){o.IsCallback=false;r.abort();r.XmlHttp2=DataAccess.Request(o)}},3e3);return r};function AdDataAccess(t){this.Slider=t;this.GetMonitoring=function(t,e,i){var a=this;if(!e||e.length<=0){return}var n=this.Slider.GetHead();var o={};o.ADPositions=e;o.PageID=t.PageId;var r=OutInterface.GetRootUrl()+"GetMonitoring.json";DataAccess.PostRequest(r,o,function(t){s()},function(){s()});function s(){i.call(t)}};this.GetAdDataList=function(t,o){var r=this;var s=this.Slider.GetHead();var d=Common.CreateGuid();var l={};l.DeviceInfo=i.call(this);l.SystemCode=parseFloat(s.syscode);l.head=s;l.ChannelID=s.sid;l.SiteID=this.Slider.SiteID;l.SiteType=this.Slider.SiteType;l.GlobalBusinessInfoList=[a.call(this)];l.Extensions=[];l.Extensions.push(n.call(this,"AllianceID",this.Slider.AllianceID));l.Extensions.push(n.call(this,"SID",this.Slider.SID));l.Extensions.push(n.call(this,"OUID",this.Slider.OUID));l.Extensions.push({Name:"requestID",Value:d});l.AdLocation={};var c=Common.GetStorage("SelectCityId");var m=Common.GetStorage("MKT_Ad_CityLonAndLat");if(parseFloat(c)>0){l.AdLocation.CityID=c}if(m){try{l.AdLocation.Longitude=JSON.parse(m).Lon;l.AdLocation.Latitude=JSON.parse(m).Lat}catch(h){}}if(Common.StringIsNullOrEmpty(l.SystemCode)){return}var u=(new Date).getTime();this.AdEndTime=0;var f=(new Date).getTime();var g={BizType:!!l.GlobalBusinessInfoList[0]?l.GlobalBusinessInfoList[0].BizType:"",PageCode:!!l.GlobalBusinessInfoList[0]?l.GlobalBusinessInfoList[0].PageCode:"",mktadtime:f,requestID:d,type:""};if(!!Lizard.isHybrid||!!Lizard.isInCtripApp){g.type="hybrid"}else{g.type="h5"}window.__bfi.push(["_tracklog","mktListFullBegin",JSON.stringify(g)]);var S=OutInterface.GetRootUrl()+"GetGlobalADListV4.json";DataAccess.PostRequest(S,l,function(t){I(t,0,r.Slider.CacheKey)},function(){I(null,0,r.Slider.CacheKey)});function I(i,a,n){var s={};r.AdEndTime=(new Date).getTime();var l={};var c=r.Slider.TagId?$("#"+r.Slider.TagId):null;if(Common.GetStorage("mkt_adsimage_list")){l=JSON.parse(Common.GetStorage("mkt_adsimage_list"))}if(i!=null&&i.Ads!=undefined&&i.Ads.length>0){s={adidAndPlaceId:!!i.Ads[0]?i.Ads[0].ADContentList:[],mktBegintime:f,mktEndtime:r.AdEndTime,listFullTime:r.AdEndTime-f,requestID:d,type:""};if(!!Lizard.isHybrid||!!Lizard.isInCtripApp){s.type="hybrid"}else{s.type="h5"}window.__bfi.push(["_tracklog","mktListFullEnd",JSON.stringify(s)]);if(i.Ads[0]&&i.Ads[0].ADContentList&&i.Ads[0].ADContentList.length>0){i.Ads[0].ADContentList[0]&&(l["mkt_adsimage"+n]=i.Ads[0].ADContentList[0].SrcUrl);Common.SetStorage("mkt_adsimage_list",JSON.stringify(l))}}else{if(l["mkt_adsimage"+n]){delete l["mkt_adsimage"+n]}Common.SetStorage("mkt_adsimage_list",JSON.stringify(l));c&&c.css({background:"none"})}Common.SetStorage("SiteType"+n,"");Common.SetStorage("SiteID"+n,"");Common.SetStorage("BidAdCount"+n,0);Common.SetStorage("DyAdIndex"+n,0);if(i&&i.Extensions&&i.Extensions.length>0){for(var m=0;m<i.Extensions.length;m++){var h=i.Extensions[m];if(h.Name==="AdSite"){Common.SetStorage("SiteType"+n,h.Key);Common.SetStorage("SiteID"+n,h.Value)}else if(h.Name==="BidAdCount"){Common.SetStorage("BidAdCount"+n,h.Value)}else if(h.Name==="DyAdIndex"){Common.SetStorage("DyAdIndex"+n,h.Value)}}}var g=Common.GetStorage("SiteID"+r.Slider.CacheKey);var S=Common.GetStorage("SiteType"+r.Slider.CacheKey);Common.TrackMetric(u,r.Slider.PageId,2,a,g,S);if(i!=null&&i.Ads!=undefined&&i.Ads.length>0){o.call(t,i.Ads)}else{!r.Slider.IsBackupLoadComplete&&r.Slider.AdLoadComplete(r.Slider,1)}r.AdEndTime=(new Date).getTime();e.call(r)}};this.GetDyAdData=function(t,a,n){var o=this;var r=this.Slider.GetHead();var s=i.call(this);var d={};d.LocationType={CityID:a};d.ScreenWidth=s.ScreenWidth;d.ScreenHeight=s.ScreenHeight;d.head=r;d.BusinessInfo={BusinessType:this.Slider.BizType,PageCode:this.Slider.PageCode};d.VID=Lizard.isHybrid?r.cid:Common.GetVId();if(Common.StringIsNullOrEmpty(r.syscode)){return}var l=(new Date).getTime();this.DyAdEndTime=0;var c=OutInterface.GetRootUrl()+"GetDynamicAd.json";DataAccess.PostRequest(c,d,function(t){m(t,0)},function(){m(null,0)});function m(i,a){var r=Common.GetStorage("SiteID"+o.Slider.CacheKey);var s=Common.GetStorage("SiteType"+o.Slider.CacheKey);Common.TrackMetric(l,o.Slider.PageId,3,a,r,s);n.call(t,i);o.DyAdEndTime=(new Date).getTime();e.call(o)}};function e(){if(this.AdEndTime>0&&this.DyAdEndTime>0){var t=Common.GetStorage("SiteID"+this.Slider.CacheKey);var e=Common.GetStorage("SiteType"+this.Slider.CacheKey);Common.TrackMetric(this.Slider.StartTime,this.Slider.PageId,1,0,t,e)}}function i(){var t={};var e=this.Slider.LocalStorage.oldGet("CINFO");var i=this.Slider.TagId;if(!$.isEmptyObject(e)){t.ScreenWidth=e.screenWidth;t.ScreenHeight=e.screenHeight;t.ScreenPxDensity=e.screenPxDensity;t.DeviceOSVersion=e.serverVersion}else{t.ScreenWidth=window.innerWidth*(window.devicePixelRatio||1);t.ScreenHeight=window.innerHeight*(window.devicePixelRatio||1)}t.ScreenWidth=Common.StringIsNullOrEmpty(this.Slider.ScreenWidth)?t.ScreenWidth:this.Slider.ScreenWidth;t.ScreenHeight=Common.StringIsNullOrEmpty(this.Slider.ScreenHeight)?t.ScreenHeight:this.Slider.ScreenHeight;if($("#"+i).width()>0){t.ScreenWidth=$("#"+i).width()*(window.devicePixelRatio||1)}if($("#"+i).height()>0){t.ScreenHeight=$("#"+i).height()*(window.devicePixelRatio||1)}return t}function a(){var t={};t.BizType=this.Slider.BizType;t.PageCode=this.Slider.PageCode;return t}function n(t,e){var i={};i.Name=t;i.Value=e;return i}}function AdBusiness(t){this.Slider=t;this.DataAccess=null;this.TagObject=null;this.AdDataList=[];this.DyAdData=null;this.AdContentList=[];var e=this.Slider.TagId;this.Init=function(){this.InitStartT=(new Date).getTime();this.DataAccess=new AdDataAccess(this.Slider);this.TagObject=$("#"+this.Slider.TagId);if(!this.TagObject){return}var t=Common.GetStorage("mkt_adsimage_list")?JSON.parse(Common.GetStorage("mkt_adsimage_list")):{};var e=t["mkt_adsimage"+this.Slider.CacheKey],o="";if(e&&(!this.Slider.TemplateVal||!this.Slider.TemplateType=="Interstitial")){o=e;if(!this.Slider.BackupImageUrl){this.Slider.BackupImageUrl=e}this.TagObject.css({background:"url("+o+") transparent no-repeat center center","background-size":"100% 100%"})}i.call(this);d.call(this);if(this.DyAdData==null){n.call(this)}this.Slider.V4StartT=(new Date).getTime();if(this.AdDataList.length==0){this.DataAccess.GetAdDataList(this,function(t){this.Slider.V4EndT=(new Date).getTime();this.AdDataList=t;a.call(this,false);r.call(this)});n.call(this,true)}else{this.Slider.V4EndT=this.Slider.V4StartT;r.call(this)}};function i(){var t="AdDataList_"+this.Slider.CacheKey;if(!$.isEmptyObject(AdDataModel.GetGlobalADListV4Model[t])){this.AdDataList=Common.Clone(AdDataModel.GetGlobalADListV4Model[t])}}function a(t){var e="";if(t){}else{e="AdDataList_"+this.Slider.CacheKey;AdDataModel.GetGlobalADListV4Model[e]=this.AdDataList}}function n(t){if(t){i.call(this);return}var e=(new Date).getTime();if(AdBusiness.SelectCityId!=undefined){o.call(this,AdBusiness.SelectCityId,e,-1,true);return}AdBusiness.SelectCityId=Common.GetStorage("SelectCityId");if(!AdBusiness.SelectCityId){AdBusiness.SelectCityId=2}if(!Common.StringIsNullOrEmpty(AdBusiness.SelectCityId)){o.call(this,AdBusiness.SelectCityId,e,-1,true);i.call(this);return}i.call(this,true);function i(t){if(!this.Slider.LonAndLat.IsEnable){if(this.Slider.LonAndLat.CityID){Common.SetStorage("SelectCityId",this.Slider.LonAndLat.CityID)}if(this.Slider.LonAndLat.Lon&&this.Slider.LonAndLat.Lat){Common.SetStorage("MKT_Ad_CityLonAndLat",JSON.stringify(this.Slider.LonAndLat))}return}this.Slider.GeoService.GeoLocation.Subscribe("AdGetCity",{onPosComplete:function(t,e){if(t&&e){Common.SetStorage("MKT_Ad_CityLonAndLat",JSON.stringify({Lat:e,Lon:t}))}},onCityComplete:function(t){var e=0;if(t!=undefined&&t.CityEntities.length>0){e=t.CityEntities[0].CityID}Common.SetStorage("SelectCityId",e)},onPosError:function(t){},onCityError:function(t){}},this,false,2e4,true,true)}}this.GetMonitoring=function(t,e){this.DataAccess.GetMonitoring(this.Slider,t,e)};function o(t,e,i,a){if(this.Slider.TemplateVal&&this.Slider.TemplateType=="Interstitial"){return}AdBusiness.SelectCityId=t;Common.SetStorage("SelectCityId",t);if(a){if(i!=-1){Common.TrackMetric(e,this.Slider.PageId,4,i)}this.Slider.DyStartT=(new Date).getTime();this.DataAccess.GetDyAdData(this,t,function(t){this.Slider.DyEndT=(new Date).getTime();if(!t||t.AID<=0){t=true}s.call(this,t)})}}function r(){var t=this;t.Slider.IsLoadAdComplate=true;var i=[];t.Slider.AdDataList=[];if(this.AdDataList.length>0){i=this.AdDataList[0].ADContentList;i=i.sort(function(t,e){return t.Index>e.Index?1:-1});
}if(i.length<=1){var a=t.Slider.TagId?$("#"+t.Slider.TagId):null;t.Slider.BackupImageUrl="";a&&a.css({background:"none"})}this.AdContentList=[];var n=[];var o=[];$.each(i,function(e,i){i.Id=Common.CreateGuid();i.AdvertisementPosition=i.PlaceID;i.AID=i.ADID;i.IsVisible=false;if(!Lizard.isHybrid){i.SrcUrl=Common.ReplaceHttp(i.SrcUrl)}if(i.Adtype<100){t.AdContentList.push(i);n.push(i.AdvertisementPosition+":"+i.AID)}else{t.Slider.AdDataList.push(i);o.push(i.AdvertisementPosition+":"+i.AID)}});if(this.DyAdData!=null){this.DyAdData.IsVisible=false;this.Slider.AddDyAdData(this.AdContentList,this.DyAdData,i)}if(this.Slider.TemplateVal&&this.Slider.TemplateType=="Interstitial"){if(Lizard.app&&Lizard.app.vendor&&Lizard.app.vendor.is("CTRIP")){Common.LoadJS("https://webresource.c-ctrip.com/ResMarketOnline/R2/js/Template/template"+this.Slider.TemplateVal+".js?v=116",function(){window.__MKT_Ad_Template&&window.__MKT_Ad_Template({tagid:e,thirdloadkurl:t.Slider.ThirdLoadkUrl,pageid:t.Slider.PageId,data:t.AdDataList[0]||[]})});if(n.length>0){t.Slider._setUBTTrackLog(1,{AdvertisementPosition:n.join("-")})}if(o.length>0){t.Slider._setUBTTrackLog(1,{AdvertisementPosition:o.join("-")})}if(!!i[0]){t.Slider._setUBTTrackLog(2,i[0])}}}else{this.Slider.BandData(this.AdContentList,i)}}function s(t){this.Slider.IsLoadDyAdComplate=true;if(!t){this.Slider.DyAdBandData(null);return}var e={};e.Id=Common.CreateGuid();e.Style=t.Style;e.IsDy=true;e.IsVisible=false;e.PlaceID=t.PlaceID>0?t.PlaceID-0:0;e.Content=t.Content;e.AID=t.AID;e.ADID=t.AID>0?t.AID-0:0;e.Adtype=0;e.SrcUrl=t.Src;e.LinkUrl=t.Link;e.Width=t.Width;e.Height=t.Height;e.TagId=t.TagId;var i=Common.GetStorage("DyAdIndex"+this.Slider.CacheKey);if(i>0){e.Index=i}else{e.Index=t.Index}if(!Lizard.isHybrid){e.SrcUrl=Common.ReplaceHttp(e.SrcUrl)}if(t.Extension&&t.Extension.length>0){$.each(t.Extension,function(t,i){e[i.Name]=i.Value})}e.AdvertisementPosition=t.PlaceID;this.DyAdData=e;a.call(this,true);this.Slider.DyAdBandData(this.DyAdData)}function d(){var t=this;this.TagObject.html("");this.Slider.IsNoAdHide&&this.TagObject.hide();if(!Common.StringIsNullOrEmpty(this.Slider.BackupImageUrl)&&!this.Slider.IsLoadComplete){this.Slider.BackupImageId=Common.CreateGuid();if(!Lizard.isHybrid){this.Slider.BackupImageUrl=Common.ReplaceHttp(this.Slider.BackupImageUrl)}var e=new Image;e.src=this.Slider.BackupImageUrl;e.onload=function(){if(!t.Slider.IsLoadComplete){var e=Common.StringFormat('<img src="{0}" id="{1}" style="width:100%;height:100%;"/>',[t.Slider.BackupImageUrl,t.Slider.BackupImageId]);t.TagObject.html(e);t.TagObject.show();t.Slider.IsBackupLoadComplete=true;t.Slider.AdLoadComplete(t.Slider,0)}}}}function l(t){var e="";if(!Common.StringIsNullOrEmpty(t)){var i=t.indexOf("?");if(i>0){t=t.substring(i+1);var a=t.split("&");for(var n=0;n<a.length;n++){if(a[n].indexOf("a=")==0){e=a[n].substring(2);break}}}}return e}}var adjs_vetsion="201901281459";function AdInit(){Common.ClearAdCache()}AdInit();return adSliderControl});