define(["gsRootView","cMemberService","cGuiderService","gsShowImages","gsTravelsDetailModel","gsAppAgent","gsHistory","cUtilCryptBase64","gsBusinessJob","gsTravelsScrollLoading","gsRouterRedirect","gsCommon","UIScroll","gsVideo"],function(e,t,i,a,s,o,n,r,d,l,c,h,p){return e.extend({pageid:function(){return o.isGsHybrid()?10320608155:214072}(),hpageid:function(){return o.isGsHybrid()?10320608155:491013}(),detailLikeModelData:s.postLikeData.getInstance(),detailCancelLikeModelData:s.cancelLikeData.getInstance(),detailCollections:s.postCollections.getInstance(),detailCancelCollections:s.postCancelCollections.getInstance(),checkCollection:s.collectionInfoJudge.getInstance(),detailAddTravelView:s.postAddTravelView.getInstance(),addFriend:s.addFriend.getInstance(),deleteFriend:s.deleteFriend.getInstance(),isFriend:s.isFriend.getInstance(),bestTravelShare:s.bestTravelShare.getInstance(),getMention:s.getMention.getInstance(),commonFavoriteAdd:s.commonFavoriteAdd.getInstance(),commonFavoriteDelete:s.commonFavoriteDelete.getInstance(),isFavCanClick:!0,isInterestUser:!1,mentionFirst:!0,commonFavoriteFlag:!0,hasMentionData:0,imageMode:1,currentPlayer:"",foodsTag:"",imageType:"无图模式",scrollSlideX:null,onCreate:function(){},onShow:function(){"undefined"!=typeof CtripUtil&&CtripUtil.logMarketPagePerformance&&CtripUtil.logMarketPagePerformance("you","491013",{}),this._gs_super(),!t.isLogin()&&o.isWeixinBrowser()&&this.weixinAuth(!1),$("body").attr("onselectstart","");var e=this;if(!this.datas.datas)return void this.setNoDataHeader();var i=this.datas.datas;this.getTagName();i.IsCollection?e.isfav=!0:e.isfav=!1,this.isInterestUser=this.datas.datas.IsFollowAuthor,this.travelsId=Lizard.P("travelsId").replace(/[^0-9]/gi,""),this.formatCss(),Lizard.isInCtripApp||Lizard.isHybrid||106147!=Lizard.P("allianceid")||549949!=Lizard.P("sid")||$("body").addClass("huawei"),this.needNoImageMode()||o.isGsHybrid()||this.$el.find(".flat_icon.quality").hide(),this.needNoImageMode()&&(this.$el.find(".action-sheet").children().eq(0).show(),this.$el.find(".action-sheet").children().eq(1).hide(),this.$el.find(".action-sheet").children().eq(2).hide()),this.changeHybridMode("6.10")&&(this.$el.find(".action-sheet").children().eq(0).hide(),this.$el.find(".action-sheet").children().eq(1).show(),this.$el.find(".action-sheet").children().eq(2).show()),o.isGsHybrid()&&(this.$el.find(".action-sheet").children().eq(0).hide(),this.$el.find(".action-sheet").children().eq(1).show(),this.$el.find(".action-sheet").children().eq(2).show());var a="you-travels-dateil-"+this.travelsId,s={type:"webapp"};h.adTrackLog(a,s),this.postAddTravelView(),this.checkIsCollection(),this.webAPPdoing(),this.goPoi(),this.changeHybridMode("6.10")?this.handleImageModel():this.handleNoImage();var n=i.Title.replace(/&amp;/g,"&").replace(/&gt/g,">").replace(/&lt/g,"<").replace(/&#183;/g,"·").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),r=this.datas.datas.IsOperationTravel?'携程攻略:【热门】"'+n+'"伙伴们都在参加快来！':n;shareInfos={title:r,content:this.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,shareUrl:this.shareUrlCheck(window.location.href)+this.hybridParam()+"&openapp=5",picUrl:$(".travels_hd").find(".cover_img").attr("src")},Lizard.isHybrid||Lizard.isInCtripApp||o.isGsHybrid()||$("header").hide(),o.isWeixinBrowser()&&(void 0===window.WeixinJSBridge?document.addEventListener("WeixinJSBridgeReady",function(){e.weixinShare(shareInfos)},!1):e.weixinShare(shareInfos)),0!=$(".highlight").length&&setTimeout(function(){$(".highlight")[0].scrollIntoView(!0)},0),$(".js_toGsHome").click(function(){h.trackLog({districtID:e.datas.datas.DistrictId},{pageid:e.pageid,hpageid:e.hpageid})}),this.handleHistory(),this.traceLog(),this.getMentionList(),this.initVideo(),travelsFn.isSeo()&&(this.scrollSlide(),this.seoListInit())},onAppear:function(e){e&&(this.header.show(),"exitFullView"===e&&this.currentPlayer&&($("video[data-state=playing]").attr("src",""),$("video[data-state=playing]").data("state","reload"),this.currentPlayer.pause()))},traceLog:function(){var e=this,t=this.datas.datas;h.cTrackLog(100088,{travelID:t.Id,districtid:t.DistrictId,actiontype:"browse",pageid:e.pageid,hpageid:e.hpageid})},handleHistory:function(){if(!this.datas.datas.IsOperationTravel&&o.isHybrid()&&o.compareAppVersion("6.18")<1){var e=this;n.saveHistory({jumpSchema:function(){if(Lizard.isHybrid){var t=e.hybridParam();return"ctrip://wireless/h5?page=index.html#travels/"+Lizard.P("district")+"/"+Lizard.P("travelsId")+t+"&path=destination/travels&navBarStyle=white"}return"ctrip://wireless/h5?url="+r.Base64.encode(location.href)+"&type=2"}(),displayContent:$(".cover .title").text()?$(".cover .title").text():e.datas.datas.Title,subTitle:e.datas.datas.DistrictName+"游记",type:8})}},hybridParam:function(){var e="";return Lizard.P("hideBrandTip")&&(e+="&hideBrandTip="+Lizard.P("hideBrandTip")),Lizard.P("type")&&(e+="&type="+Lizard.P("type")),e},handleNoImage:function(){if(this.needNoImageMode()&&o.isHybrid()){var e="WIFI"==Lizard.networkType,t=this;this.getNoImageTag(function(i){if(-1==i.tag&&!e)return t.changeImgMode(0),t.scrollLoading(),t.imageType="无图模式",t.setHeader(),void(t.compareDate(i.tipsTime)||t.datas.datas.IsOperationTravel||t.imageQualityConfirm());-1==i.tag&&e?(t.changeImgMode(0),t.scrollLoading(),t.imageType="无图模式",t.setHeader()):0!=i.tag||e?1!=i.tag||e?0==i.tag&&e?(t.changeImgMode(3),t.imageType="有图模式",t.setHeader()):1==i.tag&&e&&(t.changeImgMode(0),t.scrollLoading(),t.imageType="无图模式",t.setHeader()):(t.changeImgMode(0),t.scrollLoading(),t.imageType="无图模式",t.setHeader(),t.compareDate(i.tipsTime)||t.datas.datas.IsOperationTravel||t.imageQualityConfirm()):(t.changeImgMode(3),t.imageType="有图模式",t.setHeader())})}else this.scrollLoading()},handleImageModel:function(){var e=this;this.needNoImageMode()&&o.isHybrid()?this.getNoImageTag(function(t){0==t.tag?(e.changeImgMode(3),e.imageType="高清画质"):1!=t.tag&&2!=t.tag||(e.changeImgMode(1),e.scrollLoading(),e.imageType="无图模式"),e.setHeader(),e.compareDate(t.tipsTime)||e.datas.datas.IsOperationTravel||3==t.tipsFlag&&e.imageQualityConfirm()}):this.scrollLoading()},needNoImageMode:function(){return o.compareAppVersion("6.8")<1},changeHybridMode:function(e){return-1==o.compareAppVersion(e)},getNoImageTag:function(e){d.doBusinessJob({businessCode:9001,data:{},callback:function(t){t.param&&void 0!==t.param.tag&&e(t.param)}})},compareDate:function(e){if(!e)return!1;var t=new Date(e).getDate(),i=(new Date).getDate();return t==i},setImageTag:function(e){var t,i=this.$el.find(".flat_icon.quality"),a=(new Date).getTime();t=0==e||1==e?1:2==e?2:0,i.attr("type",e),CtripBusiness.app_do_business_job(6,9e3,{tag:t,tipsTime:a})},weixinShare:function(e){WeixinJSBridge.on("menu:share:appmessage",function(t){WeixinJSBridge.invoke("sendAppMessage",{img_url:e.picUrl,img_width:"200",img_height:"200",link:e.shareUrl,desc:e.content,title:e.title},function(e){})}),WeixinJSBridge.on("menu:share:timeline",function(t){WeixinJSBridge.invoke("shareTimeline",{img_url:e.picUrl,img_width:"200",img_height:"200",link:e.shareUrl,desc:e.content,title:e.title+e.content},function(e){})}),WeixinJSBridge.on("menu:share:weibo",function(t){WeixinJSBridge.invoke("shareWeibo",{content:e.title+e.content,url:e.shareUrl},function(e){})})},events:{"click .common-iconfont.liked":"loveFn","click .solid_icon.menu":"openMenu","click .modal.curtain_left":"closeMenu","click .travel_menu .subject":"jumpToPoint","click .solid_icon.mentioned":"openMention","click .modal.curtain":"closeMention","click .cate_name":"troggleMentionSection","click .bottom_box .comment":"inputComment","click .img_travels":"toDetailImage","click .js_close":"toClose","click .flat_icon.edit":"toEdit","click .user_card .stare":"interestUser","click .user_card .social":"copyUserInfo","click .bottle .comment":"inputComment","click .restitem_jump":"gotoDetailEvent","click .img_travels_wrap .controller":"playVRVideo","click .mentioned_item .link_area":"goPoiDetail","click .collective":"commonLike","click .robot_box":"goToWritePoem","click .js_seoTab":"seoTabChange","click .gsui_seoList a":"seoJump","click .folder_switch":"seoListJump"},toClose:function(e){$(".appue_scale").css({display:"none"}),$(".appue_scale ul").html("")},toEdit:function(){var e=this.datas.datas;0==e.TravelType||5==e.TravelType?this.showTip("为了更好的体验，此游记只能在PC上编辑。造成不便，敬请谅解",5e3):1!=e.TravelType&&4!=e.TravelType||c.ForwardPage({urls:["","/EditStory?storyId="+this.travelsId],targetModel:1})},onHide:function(){},appUrl:function(){return o.isYouth()?"ctripyouth":"ctrip"},scrollLoading:function(){var e=this,t=$(".travels_detail img");t.addClass("con_img"),t.length>0&&(t.show(),t.scrollLoading({eventsource:"scroll"})),this.winbeforeScrollTop=$(window).scrollTop(),$(window).bind("scroll",function(){var t=$(this).scrollTop(),i=t-e.winbeforeScrollTop;0!==i&&(t<10?e.titleMaskAnimate(1):e.titleMaskAnimate(i),e.winbeforeScrollTop=t)})},titleMaskAnimate:function(e){var t=this,i=t.$el.find(".notes_editor_ads");t.titleMaskTimer&&clearTimeout(t.titleMaskTimer),e>0?i.removeClass("active"):(i.addClass("active"),t.titleMaskTimer=setTimeout(function(){i.removeClass("active")},1e4))},inputComment:function(e){var a,s=this,n=this.datas.datas.ReplyCount,r=$(e.currentTarget).data("type"),d=$(e.currentTarget).data("id"),l=function(){if(o.isHybrid())return void(s.changeHybridMode("6.15")?(a=r?"destination/travels/index.html#comment/"+s.travelsId+"?edit=true&id="+d:"destination/travels/index.html#comment/"+s.travelsId,c.toJump({url:["",a],targetModel:4})):i.jump({url:s.appUrl()+"://wireless/destination/toIteComment?id="+s.travelsId+"&showKeyboard=true",targetModel:"app"}));a=r?"/webapp/you/travels/comment/"+s.travelsId+"?edit=true&id="+d+"&from="+encodeURIComponent(window.location.href):"/webapp/you/travels/comment/"+s.travelsId+"?from="+encodeURIComponent(window.location.href),c.toJump({url:[a],targetModel:2,host:!0})};if(n>0)l();else if(t.isLogin())l();else{if(!t.isLogin()&&o.isWeixinBrowser())return void s.weixinAuth(!0);t.memberLogin({param:"from="+encodeURIComponent(window.location.href),callback:function(){t.isLogin()&&l()}})}},getMentionList:function(){var e=this;this.getMention.setParam({TravelId:this.datas.datas.Id}),this.getMention.excute(function(t){var i=_.template(Lizard.T("productTmpl"));e.$el.find(".mentioned_list").append(i(t)),0==t.HotelList.length&&0==t.RestraintList.length&&0==t.ShoppingList.length&&0==t.SightList.length&&0==t.TrafficList.length?e.hasMentionData=1:e.hasMentionData=2},function(t){e.hasMentionData=3})},openMention:function(){2==this.hasMentionData?(this.$el.find(".modal.curtain").show(),this.mentionFirst&&(this.$el.find(".cate_name").eq(0).addClass("active"),this.$el.find(".cate_name").eq(1).addClass("active"),this.$el.find(".cate_list").eq(0).show(),this.$el.find(".cate_list").eq(1).show(),this.mentionFirst=!1)):0==this.hasMentionData?Lizard.showToast("游游正在努力加载内容"):1==this.hasMentionData?Lizard.showToast("没有内容诶"):Lizard.showToast("啊哦，内容不见了")},closeMention:function(e){$(e.target).hasClass("curtain")&&this.$el.find(".modal.curtain").hide()},openMenu:function(){this.$el.find(".modal.curtain_left").show()},closeMenu:function(e){$(e.target).hasClass("curtain_left")&&this.$el.find(".modal.curtain_left").hide()},jumpToPoint:function(e){$(".travel_menu .subject").removeClass("active"),$(e.currentTarget).addClass("active"),$(".gs_t_"+$(e.currentTarget).data("index"))[0].scrollIntoView(!0),this.$el.find(".modal.curtain_left").hide()},commonLike:function(e){var i=$(e.currentTarget),a=i.find(".icon_heart"),s=i.data("businessid"),n=i.data("type"),r=this;if(t.isLogin())a.hasClass("like")&&r.commonFavoriteFlag?(r.commonFavoriteFlag=!1,r.commonFavoriteDelete.setParam({CollectionTypeId:n,BusinessIds:[s]}),r.commonFavoriteDelete.excute(function(e){e.ResultInfo.Result?(Lizard.showToast("取消收藏成功"),a.removeClass("like").addClass("dislike")):Lizard.showToast("取消收藏失败"),r.commonFavoriteFlag=!0},function(e){Lizard.showToast("取消收藏失败"),r.commonFavoriteFlag=!0})):a.hasClass("dislike")&&r.commonFavoriteFlag&&(r.commonFavoriteFlag=!1,r.commonFavoriteAdd.setParam({CollectionTypeId:n,BusinessIds:[s]}),r.commonFavoriteAdd.excute(function(e){e.ResultInfo.Result?(Lizard.showToast("收藏成功，请至我的收藏查看"),a.removeClass("dislike").addClass("like")):Lizard.showToast("添加收藏失败"),r.commonFavoriteFlag=!0},function(e){Lizard.showToast("添加收藏失败"),r.commonFavoriteFlag=!0}));else{if(!t.isLogin()&&o.isWeixinBrowser())return void r.weixinAuth(!0);t.memberLogin({param:"from="+encodeURIComponent(window.location.href),callback:function(){r.commonLike()}})}},goPoiDetail:function(e){if(!$(e.target).hasClass("icon_heart")){var t,i=$(e.currentTarget).data("type"),a=$(e.currentTarget).data("businessid"),s=$(e.currentTarget).data("poiid"),n=$(e.currentTarget).data("districtid"),d=$(e.currentTarget).data("name"),l=$(e.currentTarget).data("url")||"",h=$(e.currentTarget).data("nativeurl")||"";switch(i){case 4:l=Lizard.appBaseUrl+"place/"+n+".html?from="+encodeURIComponent(window.location.href),h="/destination/toDestMain?districtId="+n+"&districtName="+d,t=1;break;case 3:o.compareAppVersion("7.11")>-1?(l=Lizard.appBaseUrl+"sight/0/"+a+".html?navBarStyle=white&ishidenavbar=yes&from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"sight/0/"+a+".html?navBarStyle=white&ishidenavbar=yes&from="+encodeURIComponent(window.location.href),t=2):(l=Lizard.appBaseUrl+"sight/0/"+a+".html?navBarStyle=white&ishidenavbar=yes&from="+encodeURIComponent(window.location.href),h="ctrip://wireless/h5?type=5&url="+r.Base64.encode("/rn_destination_poi/index.main.js?CRNModuleName=rn_destination_poi&CRNType=1&initialPage=sightDetail&businessId="+a),t=1);break;case 2:l=Lizard.appBaseUrl+"foods/0/"+a+".html?hideBrandTip=1&from="+encodeURIComponent(window.location.href),h="food/index.html#foods/0/"+a+".html?hideBrandTip=1",t=4;break;case 5:l=Lizard.appBaseUrl+"shops/0/"+a+".html?navBarStyle=white&from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"shops/0/"+a+".html?navBarStyle=white&from="+encodeURIComponent(window.location.href),t=2;break;case 50:l=Lizard.appBaseUrl+"hotels/0/hotkey-detail/"+s+".html?from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"hotels/0/hotkey-detail/"+s+".html?from="+encodeURIComponent(window.location.href),t=2;break;case 1:t=1;break;case 6:l=Lizard.appBaseUrl+"resort/0/"+a+".html?from="+encodeURIComponent(window.location.href),h="destination/ttd/index.html#resort/0/"+a+".html",t=4;break;case 7:l=Lizard.appBaseUrl+"flight/detail-"+s+".html?from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"flight/detail-"+s+".html?from="+encodeURIComponent(window.location.href),t=2;break;case 9:l=Lizard.appBaseUrl+"train/detail-"+s+".html?from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"train/detail-"+s+".html?from="+encodeURIComponent(window.location.href),t=2;break;case 8:l=Lizard.appBaseUrl+"harbour/detail-"+s+".html?from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"harbour/detail-"+s+".html?from="+encodeURIComponent(window.location.href),t=2;break;case 10:l=Lizard.appBaseUrl+"bus/detail-"+s+".html?from="+encodeURIComponent(window.location.href),h=Lizard.appBaseUrl+"bus/detail-"+s+".html?from="+encodeURIComponent(window.location.href),t=2}c.toJump({url:[l,h],targetModel:t,host:!0})}},troggleMentionSection:function(e){$(e.currentTarget).hasClass("active")?($(e.currentTarget).removeClass("active"),$(e.currentTarget).next(".cate_list").hide()):($(e.currentTarget).addClass("active"),$(e.currentTarget).next(".cate_list").show())},imageQualityConfirm:function(){var e=this;Lizard.showConfirm({datamodel:{content:"当前网速较慢，是否切换为无图模式？",btns:[{name:"无图模式",className:"events_cancel_confirm"},{name:e.changeHybridMode(6.1)?"高清画质":"有图模式",className:"events_cancel_unable"}]},events:{"click .events_cancel_unable":"cancelAction","click .events_cancel_confirm":"okAction"},okAction:function(){e.imageType="无图模式",e.changeImgMode(3),o.isHybrid()&&e.setImageTag(e.imageMode),e.setHeader(),this.hide()},cancelAction:function(){this.hide()}})},postAddTravelView:function(){var e=this;e.detailAddTravelView.setParam({TravelId:e.travelsId}),e.detailAddTravelView.excute(function(e){},function(){})},goPoi:function(){var e=this;$(".gs_a_poi,.poi_hd").off("click").on("click",function(){var t=$(this).attr("href");if(t){var a,s=$(this).data("type"),n=$(this).text(),r=o.isHybrid()||o.isGsHybrid()?t:t+"?hideBrandTip=1&from="+encodeURIComponent(window.location.href)+"&backUrl="+encodeURIComponent(window.location.href),d=r.match(/#[\S\s]*\?/);if(r=d&&d[0]?r.replace(/#[\S\s]*\?/,"?").replace(/\s*/g,"")+d[0].replace("?",""):r.replace(/#[\S\s]*\?/,"?").replace(/\s*/g,""),"4"==s&&o.isHybrid())return a=$(this).data("businessid")||$(this).data("resourceid"),i.jump({url:e.appUrl()+"://wireless/destination/toDestMain?districtId="+a+"&hideBrandTip=1&districtName="+n,targetModel:"app"}),!1;1==s?c.toJump({url:[$(this).data("url"),$(this).data("nativeurl")],targetModel:1}):c.toJump({url:[r],targetModel:2})}})},checkIsCollection:function(){if(!t.isLogin())return void this.setHeader();var e,i,a=this,s=this.datas.datas;e="0"==s.TravelType?1:9,i=o.isGsHybrid()?{BusinessId:s.Id,BusinessTypeId:0==s.TravelType?6:7}:{CollectionInfo:{BusinessId:s.Id,CollectionType:e}},this.checkCollection.setParam(i),this.checkCollection.excute(function(e){o.isGsHybrid()?e.JudgeResult?a.isfav=!0:a.isfav=!1:e.ResultInfo&&e.ResultInfo.Result?a.isfav=!0:a.isfav=!1,a.setHeader()},function(e){a.isfav=!1,a.setHeader()})},formatCss:function(){var e=this;$(".travels_detail img").on("load",function(){this.naturalWidth<100&&this.naturalHeight<100&&$(this).remove(),this.naturalWidth>=100&&3!=e.imageMode&&$(this).next(".bottle").addClass("active").show()})},interestUser:function(e){var i=this,a=$(e.currentTarget),s=!1,n=function(){s||(s=!0,i.isFriend.setParam({UserClientAuth:i.datas.datas.Auth}),i.isFriend.excute(function(e){s=!1,0==e.ResultStatus?(a.addClass("active").text("已关注"),i.isInterestUser=!0):(a.removeClass("active").text("关注"),i.isInterestUser=!1)},function(e){s=!1,a.removeClass("active").text("关注"),i.isInterestUser=!1}))};if(t.isLogin())this.isInterestUser?function(){s||(s=!0,i.deleteFriend.setParam({UserClientAuth:i.datas.datas.Auth}),i.deleteFriend.excute(function(e){s=!1,0==e.ResultStatus?(Lizard.showToast("取消关注成功"),a.removeClass("active").text("关注"),i.isInterestUser=!1):(Lizard.showToast("取消关注失败"),a.addClass("active").text("已关注"),i.isInterestUser=!0)},function(e){s=!1,Lizard.showToast("取消关注失败"),a.addClass("active").text("已关注"),i.isInterestUser=!0}))}():function(){s||(s=!0,i.addFriend.setParam({UserClientAuth:i.datas.datas.Auth}),i.addFriend.excute(function(e){s=!1,0==e.ResultStatus?(Lizard.showToast("添加关注成功"),a.addClass("active").text("已关注"),i.isInterestUser=!0):(Lizard.showToast("添加关注失败"),a.removeClass("active").text("关注"),i.isInterestUser=!1)},function(e){s=!1,Lizard.showToast("添加关注失败"),a.removeClass("active").text("关注"),i.isInterestUser=!1}))}();else{if(!t.isLogin()&&o.isWeixinBrowser())return void this.weixinAuth(!0);t.memberLogin({param:"from="+encodeURIComponent(window.location.href),callback:function(){n()}})}},copyUserInfo:function(e){var t=$(e.currentTarget).data("contact");o.isHybrid()&&(CtripUtil.app_copy_string_to_clipboard(t),Lizard.showToast($(e.currentTarget).data("key")+"信息已复制"))},setHeader:function(){if(Lizard.isHybrid||Lizard.isInCtripApp||o.isGsHybrid()){var e=this;this.datas.datas;headerJson={isShowHomeItem:!1,back:{tagname:"back",callback:function(){c.toBack({url:Lizard.P("backUrl")?Lizard.P("backUrl"):Lizard.appBaseUrl+"travels"})}},center:{tagname:"title",value:o.isGsHybrid()?[e.datas.datas.IsOperationTravel?"社区活动":"游记"]:["目的地攻略",e.datas.datas.IsOperationTravel?"活动":"游记"]},right:function(){if(Lizard.isHybrid||Lizard.isInCtripApp){var t=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-favorite@2x.png":"http://pages.c-ctrip.com/you/header_icon/blue-favorite@2x.png",i=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-favorited@2x.png":"http://pages.c-ctrip.com/you/header_icon/blue-favorited@2x.png",a=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-share@2x.png":"http://pages.c-ctrip.com/you/header_icon/blue-share@2x.png";return o.isApple()&&window.devicePixelRatio>2&&(t=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-favorite@3x.png":"http://pages.c-ctrip.com/you/header_icon/blue-favorite@3x.png",i=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-favorited@3x.png":"http://pages.c-ctrip.com/you/header_icon/blue-favorited@3x.png",a=o.isHybrid()?"http://pages.c-ctrip.com/you/header_icon/black-share@3x.png":"http://pages.c-ctrip.com/you/header_icon/blue-share@3x.png","gs-download-3x"),o.compareAppVersion("6.19")<1?[{tagname:"pageShare",httpImageUrl:a,callback:function(){e.share()}}]:o.compareAppVersion("6.16")<1?[{tagname:function(){return e.isfav?"header_collectioned":"header_collection"}(),httpImageUrl:function(){return e.isfav?i:t}(),callback:function(){e.changeFavStatus()}},{tagname:"share",iconname:"share",callback:function(){e.share()}}]:[{tagname:"share",iconname:"share",callback:function(){e.share()}}]}return o.isGsHybrid()?o.compareAppVersion("2.4.2")<1?[{tagname:function(){return e.isfav?"loved":"love"}(),iconname:function(){return e.isfav?"loved":"love"}(),callback:function(){e.changeFavStatus()}}]:[{tagname:function(){return e.isfav?"loved":"love"}(),iconname:function(){return e.isfav?"loved":"love"}(),callback:function(){e.changeFavStatus()}},{tagname:"share",iconname:"share",callback:function(){e.share()}}]:h.hideGsAppForH5()?[]:[{tagname:"operationsTravels",callback:function(){c.toJump({url:["http://m.ctrip.com/webapp/you/travels/unitedstates100047/3071864.html?from="+encodeURIComponent(location.href)],targetModel:2})}}]}(),moreMenus:function(){var t;if(Lizard.isHybrid||Lizard.isInCtripApp||o.isGsHybrid()){var i="http://pages.c-ctrip.com/you/opt/no_image@2x.png",a="http://pages.c-ctrip.com/you/opt/high_definition@2x.png",s="http://pages.c-ctrip.com/you/travels/ic_shoucang_kong@2x.png",n="http://pages.c-ctrip.com/you/travels/ic_shoucang_shi@2x.png";if(o.isApple()&&window.devicePixelRatio>2&&("http://pages.c-ctrip.com/you/icon/share_page@x3.png","http://pages.c-ctrip.com/you/icon/share_image@x3.png",i="http://pages.c-ctrip.com/you/opt/no_image@3x.png",a="http://pages.c-ctrip.com/you/opt/high_definition@3x.png",s="http://pages.c-ctrip.com/you/travels/ic_shoucang_kong@3x.png",n="http://pages.c-ctrip.com/you/travels/ic_shoucang_shi@3x.png"),o.compareAppVersion("6.19")<1||o.isGsHybrid()&&o.compareAppVersion("2.4.2")<1)return t=[{tagname:function(){return e.isfav?"header_collectioned":"header_collection"}(),value:"收藏游记",httpImageUrl:function(){return e.isfav?n:s}(),callback:function(){e.changeFavStatus()}},{tagname:"imgQuality",value:e.imageType,httpImageUrl:1==e.imageMode||0==e.imageMode?i:a,callback:function(){1==e.imageMode||0==e.imageMode?(e.changeHybridMode("6.10")?e.imageType="高清画质":e.imageType="有图模式",e.changeImgMode(3)):(e.changeHybridMode("6.10")?e.changeImgMode(1):e.changeImgMode(0),e.imageType="无图模式"),o.isHybrid()&&e.setImageTag(e.imageMode),e.setHeader()}}],o.compareAppVersion("7.3")<1&&t.push({tagname:"more_home",isDisable:!0}),t}}()},this._gs_super(headerJson),this.header.show()}},setNoDataHeader:function(){this._gs_super({center:{tagname:"title",value:["游记"]},back:{tagname:"back",callback:function(){c.toBack({url:Lizard.P("backUrl")?Lizard.P("backUrl"):Lizard.appBaseUrl+"travels"})}}})},changeFavStatus:function(e){var i,a=this,s=this.datas.datas;if(i="0"==s.TravelType?"1":"9",t.isLogin()){var n=o.isGsHybrid()?{BusinessId:s.Id,CollectionTypeId:0==s.TravelType?6:7,DistrictId:s.DistrictId}:{CollectionInfo:{CollectionType:i,BusinessId:s.Id,DistrictId:s.DistrictId}},r=o.isGsHybrid()?{BusinessId:s.Id,BusinessTypeId:0==s.TravelType?6:7}:{CollectionInfo:{BusinessId:s.Id,CollectionType:i}};this.isfav?(this.detailCancelCollections.setParam(r),this.detailCancelCollections.excute(function(e){a.isFavCanClick=!0,o.isGsHybrid()?e&&0==e.ResultCode?(a.isfav=!1,a.showTip("取消收藏成功"),a.setHeader()):a.showTip("取消收藏失败"):e&&0==e.ResultInfo.ResultCode?(a.isfav=!1,a.showTip("取消收藏成功"),a.setHeader()):a.showTip("取消收藏失败")},function(){a.isFavCanClick=!0,a.showTip("取消收藏失败")})):(this.detailCollections.setParam(n),this.detailCollections.excute(function(e){a.isFavCanClick=!0,o.isGsHybrid()?e&&0==e.ResultCode?(a.isfav=!0,a.showTip("添加收藏成功"),a.setHeader()):a.showTip("收藏失败"):e&&0==e.ResultInfo.ResultCode?(a.isfav=!0,a.showTip("添加收藏成功"),a.setHeader()):a.showTip("收藏失败")},function(){a.isFavCanClick=!0,a.showTip("收藏失败")}))}else(Lizard.isInCtripApp||Lizard.isHybrid||o.isGsHybrid())&&(a.isFavCanClick=!0,t.memberLogin({callback:function(){a.checkIsCollection()}}))},changeImgMode:function(e){var t,i=$(".img_travels"),a=$(".bottle.active");this.imageMode=e,0==e||1==e?(i.show(),a.show(),_.each(i,function(e){t=$(e).data("src")&&$(e).data("src").replace(/300_10000.jpg/g,"600_10000.jpg"),$(e).data("src",t)}),this.scrollLoading()):2==e?(i.show(),a.show(),_.each(i,function(e){t=$(e).data("src")&&$(e).data("src").replace(/600_10000.jpg/g,"300_10000.jpg"),$(e).data("src",t)}),this.scrollLoading()):(i.hide(),$(".bottle").hide())},share:function(){var e,t=this,i=t.datas.datas,a=(this.getTagName(),i.Title.replace(/&amp;/g,"&").replace(/&gt/g,">").replace(/&lt/g,"<").replace(/&#183;/g,"·").replace(/&quot;/g,'"').replace(/&#39;/g,"'")),s="";s=0==this.datas.datas.TravelStatus||3==this.datas.datas.TravelStatus?{channels:["WeixinFriend","WeixinCircle","QQ","QQZone","SMS","Email","Copy"]}:{channels:["WeixinFriend","WeixinCircle","SinaWeibo","QQ","QQZone","SMS","Email","Copy"]},e=o.compareAppVersion("7.11")<1?{sharetag:"ad",weixinCircleContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,weiboContent:i.Brief,weixinFriendContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,qqContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,qqZoneContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,defaultContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,shareUrl:t.shareUrlCheck(i.Url)+t.hybridParam()+"&openapp=5",title:t.datas.datas.IsOperationTravel?'携程攻略:【热门】"'+a+'"伙伴们都在参加快来！':a,picUrl:i.CoverImageUrl640,miniProgramPath:"pages/travel/detail?id="+Lizard.P("travelsId"),miniProgramID:"gh_9d6b235c27ed"}:{sharetag:"ad",weixinCircleContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,weiboContent:i.Brief,weixinFriendContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,qqContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,qqZoneContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,defaultContent:t.datas.datas.IsOperationTravel?"小伙伴们都在参加，你还不快来？":i.Brief,shareUrl:t.shareUrlCheck(i.Url)+t.hybridParam()+"&openapp=5",title:t.datas.datas.IsOperationTravel?'携程攻略:【热门】"'+a+'"伙伴们都在参加快来！':a,picUrl:i.CoverImageUrl640},h.shareCommon(e,s),this.datas.datas.IsBestTravel&&(this.bestTravelShare.setParam({TravelId:this.travelsId}),this.bestTravelShare.excute(function(e){},function(e){}))},getTagName:function(){var e=this.datas.datas,t=e.Label||0;return 2==t?"精华":4==t?"美图":8==t?"实用":16==t?"典藏":""},showTip:function(e,t){Lizard.showToast({datamodel:{content:e},maskToHide:!1,hideSec:t||1e3})},loveFn:function(e){var i=this;if(t.isLogin())i.datas.datas.IsLike||$(e.currentTarget).hasClass("ts-liked")?i.cancelLike(e):i.postLike(e);else{if(!t.isLogin()&&o.isWeixinBrowser())return void i.weixinAuth(!0);t.memberLogin({param:"from="+encodeURIComponent(window.location.href),callback:function(a){t.isLogin()&&(i.datas.datas.IsLike||$(e.currentTarget).hasClass("ts-liked")?i.cancelLike(e):i.postLike(e))}})}},postLike:function(){this.addLove(),this.detailLikeModelData.setParam({BusinessId:this.travelsId}),this.detailLikeModelData.excute(function(){},function(){})},cancelLike:function(){this.removeLove(),this.detailCancelLikeModelData.setParam({BusinessId:this.travelsId}),this.detailCancelLikeModelData.excute(function(){},function(){})},addLove:function(){this.datas.datas.IsLike=!0,this.datas.datas.LikeCount=this.datas.datas.LikeCount+1;var e=this.datas.datas.LikeCount;this.$el.find(".common-iconfont.liked").addClass("ts-liked").addClass("active"),!isNaN(e)&&e<99999&&($(".common-iconfont.liked").html("赞 "+parseInt(e)),$(".travels_hd .comment").html(parseInt(e)))},removeLove:function(){this.datas.datas.IsLike=!1,this.datas.datas.LikeCount=this.datas.datas.LikeCount-1;var e=this.datas.datas.LikeCount;this.$el.find(".common-iconfont.liked").removeClass("ts-liked").removeClass("active"),!isNaN(e)&&e<100001&&($(".common-iconfont.liked").html("赞 "+parseInt(e)),$(".travels_hd .comment").html(parseInt(e)))},scrollSlide:function(){var e=$(".js_scroll_tab_list"),t=this;t.scrollSlideX&&t.scrollSlideX.destroy(),_.each(e,function(e,i){var a=$(e);if(a.length>0){var s=0;a.find(".tab_item").each(function(){$(this).width($(".tab_scroller").width()/5),s+=$(this).width()+parseInt(window.getComputedStyle($(this)[0]).marginRight)+parseInt(window.getComputedStyle($(this)[0]).marginLeft)+parseInt(window.getComputedStyle($(this)[0]).paddingLeft)+1}),a.css({width:s+15+"px"}),t.scrollSlideX=new p({wrapper:$(".tab_scroller"),scroller:a.eq(0),scrollX:!0,scrollY:!1,scrollbars:!1,scrollType:"x"})}})},webAPPdoing:function(){var e=this,t=$(".travels_poi"),a=$(".travels_btm"),s=parseFloat(o.appVersion());if(o.isGsHybrid())return $("#headerview").css("display","none"),a.css("display","block"),$(".tehui,.travels_share_box,.relative_box").remove(),o.gsAppVersion()<=1.1&&$(".add_comment_btn_sya").remove(),void $(".user_header, .user_header_no_card").off("click").on("click",function(){var e,t=$(this).attr("data-auth");t&&(e="ctripgs://wireless/guestUserInfo?clientAuth="+t,c.toJump({url:[e],targetModel:1}))});("5.1"==s||o.isYouth()&&s>"1.2")&&(s="5.99"),o.isHybrid()||t.css({display:"block"}),o.isHybrid()?(s>5.81&&(t.css("display","block"),a.css("display","block")),s>5.81&&1==o.compareAppVersion("6.2")?$(".user_header, .user_header_no_card").off("click").on("click",function(){var e,t=$(this).attr("data-auth");t&&(e="destination/user/~release~/html/app.html#"+t,c.toJump({url:[e]}))}):1!=o.compareAppVersion("6.2")&&$(".user_header, .user_header_no_card").off("click").on("click",function(){var e=$(this).attr("data-auth");e&&c.toJump({url:[Lizard.H5BaseUrl+"/webapp/you/livestream/gsUser?clientAuth="+e+"&isHideHeader=true&isHideNavBar=YES"],targetModel:2})}),s<5.9&&$(".travels_detail a").each(function(){"97"==$(this).attr("data-type")&&$(this).replaceWith($(this).html())}),(o.isAndroid()&&s<5.9||o.isYouth()&&s<5.9)&&$(".travels_detail a").each(function(){"97"!=$(this).attr("data-type")&&($(this).attr("href","javascript:void(0)"),$(this).css("color","#656565"))}),$(".gs_a_poi").click(function(){var t,a=$(this).text(),s=$(this).attr("href"),o=$(this).attr("data-type");return"97"!=o&&(t=$(this).attr("href").match(/^.*\D(\d+)\.html/)[1]),"4"==o?(i.jump({url:e.appUrl()+"://wireless/destination/toDestMain?districtId="+t+"&hideBrandTip=1&districtName="+a,targetModel:"app"}),!1):"3"==o?(i.jump({url:e.appUrl()+"://wireless/destination/toResInfo?name="+a+"&type=1&id="+t,targetModel:"app"}),!1):"97"==o&&s?(i.jump({url:s,targetModel:"browser"}),!1):void 0})):$(".user_header, .user_header_no_card").off("click").on("click",function(){var e,t=$(this).attr("data-auth");t&&(e="/webapp/you/livestream/gsUser?clientAuth="+t+"&isHideHeader=true&isHideNavBar=YES&from="+encodeURIComponent(window.location.href),c.toJump({url:[e],targetModel:2,host:!0}))})},toDetailImage:function(e){var t=e.currentTarget,i=$(t).parents(".travels_detail"),s=$(i).find(".img_travels"),n=[],r="",d=[];if(s.each(function(){$(this).hasClass("con_vr")||n.push(this)}),r=n.indexOf(t),$(t).hasClass("con_vr")){var l;if(!$(t).data("type"))return;switch($(t).data("type")){case 3:l=0;break;case 4:l=1}return void(o.isGsHybrid()?window.GSApiUtil&&window.GSApiUtil.getClientVersion?c.toJump({
url:["ctripgs://wireless/VRImage?type="+l+"&url="+encodeURIComponent($(t).data("originimg"))],targetModel:1}):Lizard.showToast("更新携程攻略app，更好体验vr全景"):Lizard.isInCtripApp||Lizard.isHybrid?o.compareAppVersion("6.19.2")<1?window.CtripUtil.app_open_url("ctrip://wireless/destination/toVRImage?type="+l+"&url="+encodeURIComponent($(t).data("originimg")),1):Lizard.showToast("更新携程旅游app，更好体验vr全景"):Lizard.showToast("体验百分百vr全景，请打开携程攻略app"))}n.forEach(function(e){var t={},i=$(e).attr("data-src").replace(/_R_(300|600)_10000.jpg/g,".jpg");o.isHybrid()||o.isGsHybrid()?t.url=encodeURIComponent(i):t.src=i,d.push(t)});n.length;if(o.isHybrid())window.CtripUtil.app_open_url("ctrip://wireless/destination/toPreviewImage?index="+r+"&list="+encodeURIComponent(JSON.stringify(d)),1);else if(o.isGsHybrid())c.toJump({url:["ctripgs://wireless/ImageDisplay?index="+r+"&list="+encodeURIComponent(JSON.stringify(d))],targetModel:1});else{var h=[];n.forEach(function(e){var t=$(e).attr("data-src").replace(/_R_(300|600)_10000.jpg/g,".jpg");h.push(t)}),a.init({imgsUrl:h,detail:"",currentImg:r})}},shareUrlCheck:function(e){var t,i;return e.indexOf("?")>0?(t=e.indexOf("?"),i=e.indexOf("popup=close")>0&&e.indexOf("popup=close")>t&&e.indexOf("autoawaken=close")>0&&e.indexOf("autoawaken=close")>t?e:e.indexOf("popup=close")>0&&e.indexOf("popup=close")>t?e+"&autoawaken=close":e.indexOf("autoawaken=close")>0&&e.indexOf("autoawaken=close")>t?e+"&popup=close":e+"&popup=close&autoawaken=close"):i=e+"?popup=close&autoawaken=close",i},playVRVideo:function(e){o.isGsHybrid()?window.GSApiUtil&&window.GSApiUtil.getClientVersion?c.toJump({url:["ctripgs://wireless/VRVideo?url="+encodeURIComponent($(e.currentTarget).parent().find("img").data("source"))],targetModel:1}):Lizard.showToast("更新携程攻略app，更好体验vr视频"):Lizard.isInCtripApp||Lizard.isHybrid?o.compareAppVersion("6.19.2")<1?window.CtripUtil.app_open_url("ctrip://wireless/destination/toVRVideo?url="+encodeURIComponent($(e.currentTarget).parent().find("img").data("source")),1):Lizard.showToast("更新携程旅游app，更好体验vr视频"):Lizard.showToast("体验百分百vr视频，请打开携程攻略app")},initVideo:function(){_.each($(".videoContainer"),function(e,t){$(e).videoinit({url:$(e).data("src"),autoplay:!1,preload:!1,poster:$(e).data("poster"),reserveUrl:$(e).data("reserveurl"),skin:"default"})})},seoListInit:function(){this.$el.find(".seo_box.gsui_seoGoodsList")&&(this.$el.find(".js_seoTab").eq(0).addClass("active"),this.$el.find(".gsui_seoList").eq(0).show())},seoTabChange:function(e){var t=$(e.currentTarget);this.$el.find(".js_seoTab").removeClass("active"),t.addClass("active"),t.hasClass("gsui_seoRecommend")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoRecommendList").show(),this.$el.find(".folder_switch").hide()),t.hasClass("gsui_seoDistrict")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoDistrictList").show(),this.$el.find(".folder_switch").hide()),t.hasClass("gsui_seoSight")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoSightList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","sight")),t.hasClass("gsui_seoFood")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoFoodList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","food")),t.hasClass("gsui_seoShop")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoShopList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","shop")),t.hasClass("gsui_seoSitus")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoSitusList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","situs")),t.hasClass("gsui_seoTravel")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoTravelList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","travel")),t.hasClass("gsui_seoJourney")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoJourneyList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","journey")),t.hasClass("gsui_seoArticle")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoArticleList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","article")),t.hasClass("gsui_seoAsk")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoAskList").show(),this.$el.find(".folder_switch").show(),this.$el.find(".folder_switch").data("type","ask")),t.hasClass("gsui_seoPlay")&&(this.$el.find(".gsui_seoList").hide(),this.$el.find(".gsui_seoPlayList").show(),this.$el.find(".folder_switch").hide())},seoJump:function(e){var t=$(e.currentTarget).attr("href");c.toJump({url:[t],targetModel:2})},seoListJump:function(e){var t,i=$(e.currentTarget).data("type");switch(i){case"sight":t=$(e.currentTarget).data("sighturl");break;case"food":t=$(e.currentTarget).data("foodurl");break;case"shop":t=$(e.currentTarget).data("shopurl");break;case"situs":t=$(e.currentTarget).data("situsurl");break;case"travel":t=$(e.currentTarget).data("travelurl");break;case"journey":t=$(e.currentTarget).data("journeyurl");break;case"article":t=$(e.currentTarget).data("articleurl");break;case"ask":t=$(e.currentTarget).data("askurl")}c.toJump({url:[t],targetModel:2})},gotoDetailEvent:function(e){var t=$(e.currentTarget),i=t.data("id"),a=Lizard.P("district")+"/"+i+".html?hideBrandTip=1&fromType=main&from="+encodeURIComponent(window.location.href);c.ForwardPage({urls:[Lizard.H5BaseUrl+"/webapp/you/foods/"+a,"/food/index.html#foods/"+a],targetModel:4,forceJump:!0})},weixinAuth:function(e){var t=window.location.href.match(/\&code\=.*\&/g)&&window.location.href.match(/\&code\=.*\&/g)[0].replace("&code=","").replace("&","");if(t){var i="https://youapi.ctrip.com/openapi/Home/WeiAuthGetOpenID?siteno=1&code="+t;$.ajax({type:"get",url:i,dataType:"jsonp",success:function(e){e&&e.openid&&travelsFn.wechatLogin(e.openid,location.href)},error:function(){}})}else if(e){var a=encodeURIComponent(location.href),s="https://youapi.ctrip.com/openapi/Home/WeiAuthBase?siteno=1&state=STATE&returnurl="+a;window.location.href=s}},goToWritePoem:function(e){$(e.currentTarget).hasClass("hide")?$(e.currentTarget).removeClass("hide").addClass("active"):($(e.currentTarget).removeClass("active").addClass("hide"),c.toJump({url:[Lizard.appBaseUrl+"poem?id="+Lizard.P("travelsId")+"&type=travels&from="+encodeURIComponent(window.location.href)],targetModel:2,host:!0}))}})});