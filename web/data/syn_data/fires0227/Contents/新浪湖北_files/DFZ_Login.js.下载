/*
 *DFZ APP Login
 *
*/
sinaSSOConfig=new function(){this.entry='henan';this.setDomain=true;this.customLoginCallBack=function(loginStatus){DFZ.APP.DialogLogin.callback().call(this,loginStatus)}};(function($){$.ns("DFZ.APP");DFZ.APP.DialogLogin=(function(){var mask=null,dialog=null,un=null,pw=null,pr=null,re=null,msg=null,lo=null,pv="请输入密码",pg="邮箱／会员帐号／手机号",py="验证码",yz=null,yzm=null,yzi=null,yzw=null,callback=function(){},loginCallback=null,_callback=function(){};sinaSSOController.loginExtraQuery["vsnf"]=1;function em(m){var b="",mg='';if($.isArray(m)){for(var i=0,len=m.length;i<len;i++){b+=mg+m[i]}}else{b=mg+m}msg.show();return b}function val(obj){return $.trim(obj.val())}$(function(){mask=$('<div class="mask" style="display:none;"></div>').appendTo($("body"));dialog=$('<div class="userBox" style="display:none;z-index:999999999"> <div class="userBox_t">登录或注册<a href="javascript:;" class="close">关闭</a></div> <div class="clear">  <div class="fl">   <p class="p1">已有新浪博客、新浪邮箱帐号，可直接登录</p>   <div class="input_div">    <div class="user_pop">     <div class="user_pop_t"></div>     <div class="user_pop_c"><p class="bigtxt" id="weibo_error_msg" style="width:168px;line-height:17px;">用户名或密码错误。<a href="#" class="fcimp10">查看帮助</a></p></div>     <div class="user_pop_b"></div>     <a href="javascript:;" class="close3">关闭</a>    </div>    <a href="javascript:;" class="close2">关闭</a>   <input type="text" id="weibo_username" class="input_text" value="邮箱／会员帐号／手机号" /></div>   <div class="input_div"><input type="password" style="display:none;" id="weibo_pwd_hide" class="input_text" value="" /><input type="text" class="input_text" id="weibo_pwd" value="请输入密码" /></div><div class="input_div" id="weibo_w_yzm" style="display:none;"><input type="text" value="" style="width:50px;" id="weibo_yzm" class="input_text2" placeholder="验证码"><img src="http://login.sina.com.cn/cgi/pin.php" id="weibo_doorimg"><a id="weibo_imgChange" href="javascript:void(0);">看不清？换一张</a></div>  <div style="display: none;" class="input_div" id="vsn-box" node-type="vsn_box"><input id="vsn-input" type="text" class="input_text" autocapitalize="off" autocomplete="off" placeholder="请输入微盾动态码" maxlength="6" tabindex="4" name="vsn" node-type="vsn"></div>   <p><a href="javascript:;" onclick="return false;" id="weibo_login" class="bbtn7">登录</a><label><input type="checkbox" id="weibo_remember" class="input_checkbox" />下次自动登录</label><a href="http://account.weibo.com/forgot/password?from=index" target="_blank" class="fcimp10">忘记密码</a></p>  </div>  <div class="fr">   <p>还未开通？ </p>   <p>赶快免费注册一个吧！</p>    <a href="http://weibo.com/signup/signup.php" target="_blank" class="bbtn6">注册微博</a>  </div> </div></div>').appendTo($("body"));un=$("#weibo_username"),pw=$("#weibo_pwd"),pr=$("#weibo_pwd_hide"),msg=$("#weibo_error_msg"),re=$("#weibo_remember"),lo=$("#weibo_login"),yzm=$("#weibo_yzm"),yz=$("#weibo_doorimg"),yzi=$("#weibo_imgChange"),yzw=$("#weibo_w_yzm"),vsnBox=$("#vsn-box"),vsnInput=$("#vsn-input"),vsnInputTip=vsnInput.attr("placeholder");cls2=$(".close2",dialog);$(".close",dialog).click(function(){yzw.hide();msg.parent().parent().hide();dialog.hide();mask.hide()});cls2.hide().click(function(){un.focus().val('')});$(".close3",dialog).click(function(){msg.parent().parent().hide()});msg.parent().parent().hide();yz[0].src=sinaSSOController.getPinCodeUrl();yzi.click(function(){yz[0].src=sinaSSOController.getPinCodeUrl();return false});pw.val(pv);pw.bind({focus:function(){pw.val("");pw.hide();pr.show().focus()}});pr.bind({blur:function(){var $this=$(this);if($.trim($this.val())==""){$this.hide();pw.show();pw.val(pv)}}});un.bind({focus:function(){var $this=$(this);cls2.hide();if($.trim($this.val())==pg){$this.val("")}},blur:function(){var $this=$(this);_prelogin($.trim($this.val()));if($.trim($this.val())==""){$this.val(pg);cls2.hide()}else{cls2.show()}pr.focus()}});vsnInput.bind({focus:function(){var $this=$(this);if($.trim($this.val())==vsnInputTip){$this.val("")}},blur:function(){var $this=$(this);if($.trim($this.val())==""){$this.val(vsnInputTip)}}});function _prelogin(username){username=$.trim(username);if(username==""||username==pg){return}var arg1={username:username,checkpin:1};sinaSSOController.prelogin(arg1,_preloginCallback)}function _preloginCallback(data){if(data.showpin==2){vsnBox.show()}else{vsnBox.hide();msg.html("").parent().parent().hide()}}lo.click(login);$(document).bind("keypress",function(event){if(event.keyCode==13){login()}});function check(){var unv=val(un),pwv=val(pr),yzv=val(yzm),vsnCode=val(vsnInput);if(unv==""||unv==pg){msg.html(em('请填写帐号')).parent().parent().show();return false}else if(pwv==""){msg.html(em('请填写密码')).parent().parent().show();return false}else if(yzw.is(":visible")&&(yzv==""||yzv==py)){msg.html(em('请输入验证码')).parent().parent().show();return false}else if(vsnBox.is(":visible")&&(vsnCode==""||vsnCode==vsnInputTip)){msg.html(em('请输入微盾动态码')).parent().parent().show();return false}else{msg.html("").parent().parent().hide();return true}}function login(){sinaSSOController.customLoginCallBack=function(json){_loginCallback(json)};var unv=val(un),pwv=val(pr),cvv=re.attr("checked");if(yzw.is(":visible")){sinaSSOController.loginExtraQuery.door=yzm.val()}if(vsnBox.is(":visible")){sinaSSOController.loginExtraQuery['vsnval']=vsnInput.val()}if(check()){sinaSSOController.login(unv,pwv,cvv?30:0)}}function _loginCallback(loginStatus){if(loginStatus.result){dialog.hide();msg.hide();mask.hide();setTimeout(function(){callback();_callback();location.reload()},100)}else{var errno=parseInt(loginStatus.errno,10);if(errno===4049){yzw.show()}else if(errno===2070){yzw.show();yzi.trigger("click");msg.html(em('验证码错误，请重新输入')).parent().parent().show()}else if(errno===5024||errno===5025){vsnBox.show();msg.html(em('微盾动态码错误，请重新输入')).parent().parent().show()}else{var reason=(typeof(loginStatus.reason)!='undefinded'&&loginStatus.reason)?loginStatus.reason:'帐号或密码错误';msg.html(em(reason)).parent().parent().show()}}}loginCallback=_loginCallback});return{open:function(o){if($.isFunction(o)){o={callback:o}};o=$.extend({callback:function(){}},o||{});_callback=o.callback;pw.val(pv).show();pr.val("").hide();re.attr("checked",true);msg.hide();un.val("").blur();dialog.show().css('top',$(window).scrollTop()+$(window).height()/2-100);mask.css('height',$("body").height()).show()},close:function(){dialog.hide()},callback:function(){return loginCallback},hasLogin:function(){return!!sinaSSOManager.getSinaCookie()}}})()})(jQuery);$(function(){try{var info=sinaSSOController.getSinaCookie();$(".i_nick").each(function(i,v){$(v).attr('href','http://weibo.com/u/'+info.uid).html(info.nick).parent().show().next().hide()})}catch(e){$(".i_login").parent().show()};$(".i_login").live('click',function(){DFZ.APP.DialogLogin.open({callback:function(){location.reload()}})});$(".i_reg").live('click',function(){window.open('http://weibo.com/signup/signup.php')});$(".i_logout").live('click',function(){location.href='http://weibo.com/logout.php?backurl='+location.href})});