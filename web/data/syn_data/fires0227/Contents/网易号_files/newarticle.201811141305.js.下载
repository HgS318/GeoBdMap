var url={next:"/v2/article/next.do",list:"/v2/article/list.do",add:"/v2/subscribe/add.do",rem:"/v2/subscribe/rem.do",status:"/v2/subscribe/sublist/"};!function(t){function e(){a(url.next,{wemediaId:p,docid:h,ptime:g},function(e){1===e.code&&(null!==e.data?(t("#js-next").attr("href","/v2/article/detail/"+e.data.docid+".html").text(e.data.title),t("#js-next").closest(".next").removeClass("hidden")):t("#js-next").remove())},"GET")}function i(){t(".s_loading").removeClass("hidden"),v=!0,!1!==r.data("current")&&o()}function o(){var e=r.height(),i=parseInt(r.data("current"))+1;t.ajax({url:url.list,type:"GET",dataType:"json",data:{pageNo:i,wemediaId:p,size:10}}).then(function(i){if(1!==i.code)return!1;if(i.data.list.length>0){var o,a,n={list:i.data.list},s=n.list.length;for(o=0;o<s;o++)"string"==typeof n.list[o].imgsrc&&(n.list[o].imgsrc=n.list[o].imgsrc.replace("bigimg||","").split("||")[0].trim(),(a=n.list[o].imgsrc.match(/\.(jpe?g|png|gif|bmp)$/i))&&a.length>1?n.list[o].imgsuffix=a[1]:n.list[o].imgsuffix="jpeg");r.append(template.compile(T)(n)),c.scrollTop(e);var l=!!i.data.hasNext&&i.data.pageNo;r.data("current",l)}!1===i.data.hasNext&&(f=!1,t(".s_loading").text("\u62c9\u5230\u5e95\u5566")),v=!1})}function a(e,i,o,a){t.ajax({url:e,type:a||"POST",dataType:"json",data:i}).then(function(t){o(t)})}function n(){return t(window).height()-c[0].offsetTop-c[0].offsetParent.offsetTop}function s(e){var i=t("#"+e),o=i.find(".hw-layer-wrap");i.fadeIn(),o.css({"margin-top":-o.outerHeight()/2})}function l(){t(".hw-overlay").fadeOut()}NTES.ready(function(t){var e=NTESCommonNavigator.core.Controller,i=NTESCommonNavigator.core.Event.Base;(NTESCommonNavigator.utils.app=e()).bind(i.DATA_CHANGED,function(t){location.reload()})});var c=t(".colum_article_lise_outer"),r=t(".colum_article_lise"),d=t('[data-toggle="js-follow"]'),u=n(),f=!0,v=!0,m=t("#contain"),p=m.data("wemediaid"),h=m.data("docid"),g=m.data("ptime"),w=t(".js-input-bar"),x=m.find(".video"),y=t("#content").data("cover").split(",");c.height(u),w.addClass("z-input-fold"),i(),e(),t(".z-input-fold").on("click",".js-submit-btn",function(t){w.removeClass("z-input-fold")});var T='{{each list as value}}<li class="article_item{{if value.docid == "'+h+'"}} active {{/if}}" id="{{value.docid}}"><a class="content" href="/v2/article/detail/{{value.docid}}.html"><span class="item_time">{{value.ptime}}</span><p>{{value.title}}</p>{{if value.imgsrc && value.docid != "'+h+'"}}<div class="imghover"><img src="http://nimg.ws.126.net/?url={{value.imgsrc}}&thumbnail=260x150&quality=75&type={{value.imgsuffix}}" alt="\u56fe\u7247"></div>{{/if}}</a></li>{{/each}}';d.on("click",function(e){var i=t(this);i.hasClass("active")?a(url.rem,{wemediaId:p},function(t){if(1!==t.code)return!1;i.removeClass("active").text("+ \u5173\u6ce8")}):a(url.add,{wemediaId:p},function(e){if(1===e.code)i.addClass("active"),i.html('<i class="onok"></i>\u5df2\u5173\u6ce8'),t(".followok").fadeIn();else if(-1===e.code)s("hw-layer");else{if(100021!==e.code)return!1;t(".noLoginIn").fadeIn()}})}),t(".close_btn").on("click",function(){t(".followok").fadeOut()}),t(".close_warn").on("click",function(){t(".noLoginIn").fadeOut()}),d.on("mouseover",function(){t(this).hasClass("active")&&t(this).html("\u53d6\u6d88\u5173\u6ce8")}),d.on("mouseout",function(){t(this).hasClass("active")&&t(this).html('<i class="onok"></i>\u5df2\u5173\u6ce8')});var b=t(".colum_des");c.on("scroll",function(){var e=this,o=t(e).height();t(e).find("ul").height()-o-t(e).scrollTop()<=0&&0==v&&1==f&&setTimeout(i(),2e3),t(e).scrollTop()<100?b.removeClass("scrollHide"):b.hasClass("scrollHide")||(b.addClass("scrollHide"),t(e).height(n()))});var C=t(".to_show");if(C.is(":visible")){var k=C[0].offsetTop+C[0].offsetParent.offsetTop-105;t(document).on("scroll",function(){var e=t(this),i=t(".to_show");e.scrollTop()>k?i.addClass("z-fixed"):i.removeClass("z-fixed")})}t(".gototop").on("click",function(){t(window).scrollTop(0)}),t(".special-share-weixin").on("click",function(e){t(".nt-wx2dcode-pop").css({top:"80px"}).fadeIn()}),t("body").on("click",".nt-wx2dcode-close",function(){t(".nt-wx2dcode-pop").fadeOut()}),t(".hwLayer-ok,.hwLayer-cancel,.hwLayer-close").on("click",function(){l()}),t(".hw-overlay").on("click",function(t){t.target==this&&l()}),t(document).keyup(function(t){27==t.keyCode&&l()}),t.each(x,function(e,i){t(i).after('<div class="video-root"><div class="cover js-cover" style="background: url('+y[e]+') no-repeat center center; background-size: 100% 100%"><div class="play-btn"></div></div></div>')}),t(".js-cover").on("click",function(e){e.preventDefault(),e.stopPropagation();var i=t(this),o=i.closest(".video-root").prev(".video")[0].innerHTML.replace(/(^\<\!--)|(--\>)/g,"");i.html(o)})}(jQuery);