<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
        #allmap{width:100%;height:100%;}
        p{margin-left:5px; font-size:14px;}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=n3xc9ALenVeuL9apmqs4ZjrluhhsX4mr"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
    <title>添加复杂内容的信息窗口</title>
</head>
<body>
<div id="allmap"></div>
</body>
</html>
<script type="text/javascript">
    var data = {
        "1": {
            "name": "尚海湾豪庭 小区",

            "polygon": "[ [121.465797, 31.187669], [121.466938, 31.186897], [121.466462, 31.186279], [121.466902, 31.185877], [121.468618, 31.185036], [121.469696, 31.187407], [121.466804, 31.188897]]",
            // "line2":"[ [121.457387, 31.225745], [121.457791, 31.225039], [121.458271, 31.224228], [121.458613, 31.223645], [121.458837, 31.223139], [121.458887, 31.222788]]",
            "text": "恒盛·尚海湾项目位于上海市徐汇区宛平南路1455弄，地处宛平南路与龙腾大道交汇处，是世博会最佳观礼台，可直接眺望黄浦江对岸的世博会国家馆群。与黄浦江相隔仅50米，雄踞徐汇滨江板块一线江景资源，8万平米滨江亲水公园正对面，“西岸文化走廊”各项艺术配套环伺项目左右，毗邻徐家汇商圈，滨江龙腾大道连通外滩区域。",

            // "text2":"富民路北起延安中路，南至长乐路，一条短小精悍的路。从常德路一路往南走，经过宽阔的延安中路便来到了并不宽的富民路。开始的一段路还没有那么的窄，到了巨鹿路与富民路的路口，你会发现路明显就变窄了，只有两车宽。路上小店也明显的多了起来，由巨鹿路、富民路和长乐路组成的黄金工字区里可是小店扎堆的地方，很多小店都各具特色。 道旁梧桐掩映得幽暗，仿佛有着诱人秘密等你去探寻。越走越深、越走越静，路旁沉淀时间的建筑，散发出岁月的味道。",
            "image": ["../../data/syn_data/建筑道路数据/尚海湾豪庭/2.jpg"],
            // "image2":"data/syn_data/建筑道路数据/富民路/2.jpg",
            "spaType": 5
        },
        "2": {
            "name": "尚海湾豪庭小区 - \"天鸿·尚海湾\"",

            // "line1":"[ [121.456151, 31.227961], [121.456596, 31.227347], [121.457009, 31.226579], [121.457396, 31.22573], [121.457786, 31.225042]]",
            "polygon": "[ [121.468645, 31.187078], [121.468654, 31.186916], [121.469036, 31.186909], [121.469139, 31.186939], [121.469337, 31.187287], [121.469175, 31.187364], [121.469112, 31.187272], [121.468982, 31.187299], [121.468955, 31.187202], [121.469067, 31.187183], [121.469031, 31.187132], [121.468977, 31.18714], [121.468924, 31.187129], [121.468946, 31.187075], [121.468834, 31.187078], [121.46882, 31.187136], [121.468726, 31.187132], [121.468726, 31.18709]]",
            // "text1":"富民路(Fumin Lu)　在上海市市区中部，跨静安、徐汇两区。北起延安中路，南至东湖路。长625米，宽15.0～17.0米，车行道宽9.0～9.3米。民国2年(1913年)筑，以法国海军中将名命名古拔路(Rue Amiral Courbet)。民国32年以云南富民改今名。沿路为住宅。",
            "text": "新古典主义建筑风格、全天然石材外立面，搭配皇家园林内景，以及超2000㎡天际泳池、风雨连廊、海神广场等小品精心点缀。由香港两大国宝级室内设计师—高文安与梁志天领衔设计精装展示间。",

            // "image1":"data/syn_data/建筑道路数据/富民路/1.jpg",
            "image": ["../../data/syn_data/建筑道路数据/尚海湾豪庭/3.jpg"],
            "spaType": 5
        },
        "3": {
            "name": "尚海湾豪庭 小区",

            // "line1":"[ [121.456151, 31.227961], [121.456596, 31.227347], [121.457009, 31.226579], [121.457396, 31.22573], [121.457786, 31.225042]]",
            "polygon": "[ [121.465797, 31.187669], [121.466938, 31.186897], [121.466462, 31.186279], [121.466902, 31.185877], [121.468618, 31.185036], [121.469696, 31.187407], [121.466804, 31.188897]]",
            // "text1":"富民路(Fumin Lu)　在上海市市区中部，跨静安、徐汇两区。北起延安中路，南至东湖路。长625米，宽15.0～17.0米，车行道宽9.0～9.3米。民国2年(1913年)筑，以法国海军中将名命名古拔路(Rue Amiral Courbet)。民国32年以云南富民改今名。沿路为住宅。",
            "texts": ["恒盛·尚海湾项目位于上海市徐汇区宛平南路1455弄，地处宛平南路与龙腾大道交汇处，是世博会最佳观礼台，可直接眺望黄浦江对岸的世博会国家馆群。与黄浦江相隔仅50米，雄踞徐汇滨江板块一线江景资源，8万平米滨江亲水公园正对面，“西岸文化走廊”各项艺术配套环伺项目左右，毗邻徐家汇商圈，滨江龙腾大道连通外滩区域。",
                "新古典主义建筑风格、全天然石材外立面，搭配皇家园林内景，以及超2000㎡天际泳池、风雨连廊、海神广场等小品精心点缀。由香港两大国宝级室内设计师—高文安与梁志天领衔设计精装展示间。"],
            // "image1":"data/syn_data/建筑道路数据/富民路/1.jpg",
            "image": ["../../data/syn_data/建筑道路数据/尚海湾豪庭/2.jpg",
                "../../data/syn_data/建筑道路数据/尚海湾豪庭/3.jpg"],
            "spaType": 5
        }
    };
    var id = getQueryString("id");
    if(id == "") {
        id = "1";
    }
    overlays = [];
    var infoWindow;
    var Data = data[id];
    var pointArray=Data["polygon"];
    var lineArr = JSON.parse(pointArray);
    var point=lineArr[0];
    var X=point[0];
    var Y=point[1];
    var _point = new BMap.Point(X, Y);
    var map = new BMap.Map("allmap");
    map.centerAndZoom(_point, 16);
    map.enableScrollWheelZoom(true);
    createData(Data);
    if(overlays.length > 0) {
        openInfoWin(null, {target: overlays[0]});
    }

    function createData(Data) {
        var content = createContent(Data);
        var overlay = createOverlay(Data);
        overlays.push(overlay);
        addOverlayAndWindow(overlay, Data, content);
    }

    function createContent(Data) {

        var content = '<div style="width: 320px">' +
            '<h4 style="margin: 0 0 0 0; padding: 0 0 0 0; color: #be2924; font-size: 18px">' + Data['name'] + '</h4><br/>';
        if(Data.address != null && Data.address != undefined) {
            content += '地址：' + Data.address + '<br/>';
        }
        if(Data['text'] != null) {
            var text = Data['text'];
            if(text.length > 60) {
                text = text.substring(0, 60) + '...';
            }
            content += "<strong>文字</strong><p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>" + text + "</p>";
        }
        if(Data['texts'] != null) {
            content += "<strong>文字</strong>";
            for(var j = 0; j < Data['texts'].length; j++) {
                var text = Data['texts'][j];
                if(text.length > 45) {
                    text = text.substring(0, 45) + '...';
                }
                content += "<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>" + text + "</p>";
            }
        }
        if(Data['image'] != null && Data['image'].length > 0) {
            content += '<strong>图像</strong><br/>';
            for (var j = 0; j < Data['image'].length; j++) {
                var img_path = Data['image'][j];
//                                content += "<img src='" + img_path + "' class='img' alt='' onclick='openWindowY(img_path)'"
//                                        + "style='zoom:1;overflow:hidden;width:50px;height:50px;'/>";
                content += '&nbsp;&nbsp;<img src=' + img_path + ' class="img" onclick="openWindowY(this, \'image\')" ' +
                    'alt="" style="zoom:1;overflow:hidden;width:50px;height:50px;"/>'

            }
            content += '<br/>';
        }
        if(Data['vedios'] != null && Data['vedios'].length > 0) {
            content += '<strong>视频</strong><br/>';
            for (var j = 0; j < Data['vedios'].length; j++) {
                var vedio_path = Data['vedios'][j];
//                                content += ('&nbsp;&nbsp;&nbsp;' + '<a href="' + vedio_path + '" target="_blank" onclick="openWindowY(this, \'vedio\')">视频' + (j + 1) + '</a>');
                content += ('&nbsp;&nbsp;&nbsp;' + '<a href="' + vedio_path +'" target="_blank">视频' + (j + 1) + '</a>');
            }
            content += '<br/>';
        }
        if(Data['audios'] != null && Data['audios'].length > 0) {
            content += '<strong>音频</strong><br/>';
            for (var j = 0; j < Data['audios'].length; j++) {
                var audio_path = Data['audios'][j];
                content += ('&nbsp;&nbsp;&nbsp;' + '<a href="' + audio_path +'" target="_blank">音频' + (j + 1) + '</a>');
            }
            content += '<br/>';
        }
        if(Data['models'] != null && Data['models'].length > 0) {
            content += '<strong>模型</strong><br/>';
            for (var j = 0; j < Data['models'].length; j++) {
                var model_paths = Data['models'][j];
                var model_pic = model_paths.split(':');
                var model_path = model_pic[0];
                var model_pic = model_pic[1];
                content += '<img src=' + model_pic + ' class="img" href="' + model_path + '" ' +
                    'target="_blank" alt="" style="zoom:1;overflow:hidden;width:50px;height:50px;"/>'
//                                content += ('&nbsp;&nbsp;&nbsp;' + '<a href="' + vedio_path + '" onclick="getHref()">视频' + (j + 1) + '</a>');
            }
            content += '<br/>';
        }
        content += '</div>';
        return content;
    }

    function createOverlay(Data) {

        var pointStr = Data['position'];
        if(pointStr != null && pointStr != undefined) {
            var pointArray = pointStr.split(",");
            var X = pointArray[0];
            var Y = pointArray[1];
            var Point = new BMap.Point(X, Y);
            var marker = new BMap.Marker(Point);
            marker.spaType = 1;
            return marker;
        }
        var lineStr = Data['line'];
        if(lineStr != null && lineStr != undefined) {
            var polyline = getFigureByStr(lineStr, "line");
            polyline.spaType = 3;
            return polyline;
        }
        var polygonStr = Data['polygon'];
        if(polygonStr != null && polygonStr != undefined) {
            var polygon = getFigureByStr(polygonStr, "polygon");
            polygon.spaType = 5;
            return polygon;
        }
    }

    function addOverlayAndWindow(overlay, DataData, content) {
        overlay.name = DataData.name;
        overlay.extData = DataData;
        addClickHandler(overlay, content);
        map.addOverlay(overlay);
    }

    function addClickHandler(overlay, content){
        overlay.addEventListener("click",function(e) {
            openInfoWin(content, e);
        });
    }

    function openInfoWin(content, e){
        var overlay = e.target;
        var point;
        if(overlay.spaType == 1) {
            point = new BMap.Point(overlay.getPosition().lng, overlay.getPosition().lat);
        } else if (overlay.spaType == 3 || overlay.spaType == 5) {
            var first_point = overlay.getPath()[0];
            point = new BMap.Point(first_point.lng, first_point.lat);
        } else {
            point = new BMap.Point(e.x, e.y);
        }
        if(content == null || content === undefined) {
            content = createContent(overlay.extData);
        }
        infoWindow = new BMap.InfoWindow(content);
        map.openInfoWindow(infoWindow, point);
    }

    function getFigureByStr(coordStr, type) {
        var lineArr = JSON.parse(coordStr);
        return getFigureJson(lineArr, type);
    }

    function getFigureJson(coordJson, type) {
        if(type == "point" | type == 1) {
            var marker = new BMap.Marker(coordJson[0], coordJson[1]);
            return marker;
        }
        var bdPointArr = [];
        for(var i = 0; i < coordJson.length; i++) {
            var [_x, _y] = coordJson[i];
            var bp = new BMap.Point(_x, _y);
            bdPointArr.push(bp);
        }
        if(type == "line" || type == 3) {
//            var polyline = new BMap.Polyline(bdPointArr);
            var polyline = new BMap.Polyline(bdPointArr, {strokeColor:"red", strokeWeight:6, strokeOpacity:0.9});
            return polyline;
        } else {
            var polygon = new BMap.Polygon(bdPointArr);
            return polygon;
        }
    }

    function getQueryString(name) {
        var result = location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
        if (result == null || result.length < 1) {
            return "";
        }
        return result[1];
    }
</script>
